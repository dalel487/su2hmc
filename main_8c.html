<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>su2hmc: main.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">su2hmc
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('main_8c.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">main.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Hybrid Monte Carlo algorithm for Two Colour QCD with Wilson-Gor'kov fermions based on the algorithm of Duane et al. Phys. Lett. B195 (1987) 216.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;assert.h&gt;</code><br />
<code>#include &lt;<a class="el" href="coord_8h_source.html">coord.h</a>&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &lt;<a class="el" href="matrices_8h_source.html">matrices.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="par__mpi_8h_source.html">par_mpi.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="random_8h_source.html">random.h</a>&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;<a class="el" href="su2hmc_8h_source.html">su2hmc.h</a>&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for main.c:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main_8c__incl.svg" width="940" height="626"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="main_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0ddf1224851353fc92bfbff6f499fa97" id="r_a0ddf1224851353fc92bfbff6f499fa97"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr class="separator:a0ddf1224851353fc92bfbff6f499fa97"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Hybrid Monte Carlo algorithm for Two Colour QCD with Wilson-Gor'kov fermions based on the algorithm of Duane et al. Phys. Lett. B195 (1987) 216. </p>
<p>There is "up/down partitioning": each update requires one operation of <a class="el" href="su2hmc_8h.html#a4b97a088fd74bb3b25ce4f965dc26281" title="Matrix Inversion via Conjugate Gradient (up/down flavour partitioning). Solves  Implements up/down pa...">Congradq()</a> on complex*16 vectors to determine \((M^{\dagger} M)^{-1}  \Phi\) where \(\Phi\) has dimension 4*kvol*nc*Nf - The matrix M is the Wilson matrix for a single flavor there is no extra species doubling as a result</p>
<p>Matrix multiplies done using routines <a class="el" href="matrices_8h.html#aa455f004090044b721b079277a91a753" title="Evaluates  in double precision.">Hdslash()</a> and <a class="el" href="matrices_8h.html#afa508c94d2aca3c459021f8a4434471c" title="Evaluates  in double precision.">Hdslashd()</a></p>
<p>Hence, the number of lattice flavors Nf is related to the number of continuum flavors \(N_f\) by \( \text{Nf} = 2 N_f\)</p>
<p>Fermion expectation values are measured using a noisy estimator. on the Wilson-Gor'kov matrix, which has dimension 8*kvol*nc*Nf inversions done using <a class="el" href="su2hmc_8h.html#aa3fde21d836b340202ca6b18bead4510" title="Matrix Inversion via Conjugate Gradient (no up/down flavour partitioning). Solves  The matrix multipl...">Congradp()</a>, and matrix multiplies with <a class="el" href="matrices_8h.html#a3bf73559400880606e72700009446849" title="Evaluates  in double precision.">Dslash()</a>, <a class="el" href="matrices_8h.html#a4da2b8a16d0703d183947fb98a70d731" title="Evaluates  in double precision.">Dslashd()</a></p>
<p>Trajectory length is random with mean dt*stepl The code runs for a fixed number ntraj of trajectories.</p>
<p>\(\Phi\): pseudofermion field <br  />
 bmass: bare fermion mass <br  />
 \(\mu\): chemical potential <br  />
 actiona: running average of total action <br  />
</p>
<p>Fermion expectation values are measured using a noisy estimator.</p>
<p>outputs: <br  />
 fermi psibarpsi, energy density, baryon density <br  />
 bose spatial plaquette, temporal plaquette, Polyakov line <br  />
 diq real&lt;qq&gt;</p>
<dl class="section author"><dt>Author</dt><dd>SJH (Original Code, March 2005) </dd>
<dd>
P.Giudice (Hybrid Code, May 2013) </dd>
<dd>
D. Lawlor (Fortran to C Conversion, March 2021. Mixed Precision. GPU, March 2024) </dd></dl>

<p class="definition">Definition in file <a class="el" href="main_8c_source.html">main.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a0ddf1224851353fc92bfbff6f499fa97" name="a0ddf1224851353fc92bfbff6f499fa97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ddf1224851353fc92bfbff6f499fa97">&#9670;&#160;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>argc</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>argv</em></span>[]&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>For the early phases of this translation, I'm going to try and copy the original format as much as possible and keep things in one file. Hopefully this will change as we move through the methods so we can get a more logical structure.</p>
<p>Another vestige of the Fortran code that will be implemented here is the frequent flattening of arrays. But while FORTRAN Allows you to write array(i,j) as array(i+M*j) where M is the number of rows, C resorts to pointers</p>
<p>One change I will try and make is the introduction of error-codes (nothing to do with the Irish postal service) These can be found in the file errorcode.h and can help with debugging</p>
<p>Lastly, the comment style for the start of a function is based off of doxygen. It should consist of a description of the function, a list of parameters with a brief explanation and lastly what is returned by the function (on success or failure). </p>
<h2><a class="anchor" id="inputs"></a>
Input Parameters.</h2>
<p>The input file format is like the table below, with values sepearated by whitespace</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">0.0100   </th><th class="markdownTableHeadNone">1.7   </th><th class="markdownTableHeadNone">0.1780   </th><th class="markdownTableHeadNone">0.00   </th><th class="markdownTableHeadNone">0.000   </th><th class="markdownTableHeadNone">0.0   </th><th class="markdownTableHeadNone">0.0   </th><th class="markdownTableHeadNone">100   </th><th class="markdownTableHeadNone">4   </th><th class="markdownTableHeadNone">1   </th><th class="markdownTableHeadNone">5   </th><th class="markdownTableHeadNone">1    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">dt   </td><td class="markdownTableBodyNone">beta   </td><td class="markdownTableBodyNone">akappa   </td><td class="markdownTableBodyNone">jqq   </td><td class="markdownTableBodyNone">thetaq   </td><td class="markdownTableBodyNone">fmu   </td><td class="markdownTableBodyNone">aNf   </td><td class="markdownTableBodyNone">stepl   </td><td class="markdownTableBodyNone">ntraj   </td><td class="markdownTableBodyNone">istart   </td><td class="markdownTableBodyNone">icheck   </td><td class="markdownTableBodyNone">iread   </td></tr>
</table>
<p>The default values here are straight from the FORTRAN. Note that the bottom line labelling each input is ignored</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dt</td><td>Step length for HMC <br  />
 </td></tr>
    <tr><td class="paramname">beta</td><td>Inverse Gauge Coupling </td></tr>
    <tr><td class="paramname">akappa</td><td>Hopping Parameter </td></tr>
    <tr><td class="paramname">jqq</td><td>Diquark Source </td></tr>
    <tr><td class="paramname">thetaq</td><td>Depericiated/Legacy. </td></tr>
    <tr><td class="paramname">fmu</td><td>Chemical Potential </td></tr>
    <tr><td class="paramname">aNf</td><td>Depreciated/Legacy </td></tr>
    <tr><td class="paramname">stepl</td><td>Mean number of steps per HMC trajectory </td></tr>
    <tr><td class="paramname">istart</td><td>If 0, start from cold start. If one, start from hot start </td></tr>
    <tr><td class="paramname">iprint</td><td>How often are measurements made (every iprint trajectories) </td></tr>
    <tr><td class="paramname">icheck</td><td>How often are configurations saved (every icheck trajectories) </td></tr>
    <tr><td class="paramname">iread</td><td>Config to read in. If zero, the start based on value of istart</td></tr>
  </table>
  </dd>
</dl>
<h2><a class="anchor" id="initialise"></a>
Initialisation</h2>
<p>Changing the value of istart in the input parameter file gives us the following start options. These are quoted from the FORTRAN comments</p>
<p>istart &lt; 0: Start from tape in FORTRAN?!? How old was this code? (depreciated, replaced with iread)</p>
<p>istart = 0: Ordered/Cold Start For some reason this leaves the trial fields as zero in the FORTRAN code?</p>
<p>istart &gt; 0: Random/Hot Start</p>
<h2><a class="anchor" id="timing"></a>
Timing</h2>
<p>To time the code compile with </p><pre class="fragment">-DSA3AT </pre><p> This is arabic for hour/watch so is probably not reserved like time is</p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00079">79</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   79</span>                                {</div>
<div class="line"><span class="lineno">   80</span>   <span class="comment">//Instead of hard coding the function name so the error messages are easier to implement</span></div>
<div class="line"><span class="lineno">   81</span>   <span class="keyword">const</span> <span class="keywordtype">char</span> *funcname = <span class="stringliteral">&quot;main&quot;</span>;</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>   <a class="code hl_function" href="par__mpi_8h.html#a6f500abd59b184cac1dbcf47b04c185a">Par_begin</a>(argc, argv);</div>
<div class="line"><span class="lineno">   84</span>   <span class="comment">//Add error catching code...</span></div>
<div class="line"><span class="lineno">   85</span><span class="preprocessor">#if(nproc&gt;1)</span></div>
<div class="line"><span class="lineno">   86</span>   MPI_Comm_rank(comm, &amp;<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>);</div>
<div class="line"><span class="lineno">   87</span>   MPI_Comm_size(comm, &amp;<a class="code hl_variable" href="par__mpi_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a>);</div>
<div class="line"><span class="lineno">   88</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">   89</span></div>
<div class="line"><span class="lineno">  113</span>   <span class="keywordtype">float</span> beta = 1.7f;</div>
<div class="line"><span class="lineno">  114</span>   <span class="keywordtype">float</span> akappa = 0.1780f;</div>
<div class="line"><span class="lineno">  115</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  116</span>   __managed__ </div>
<div class="line"><span class="lineno">  117</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  118</span>      <a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a> jqq = 0;</div>
<div class="line"><span class="lineno">  119</span>   <span class="keywordtype">float</span> fmu = 0.0f; <span class="keywordtype">int</span> iread = 0; <span class="keywordtype">int</span> istart = 1;</div>
<div class="line"><span class="lineno">  120</span>   <span class="keywordtype">int</span> iprint = 1; <span class="comment">//How often are measurements made</span></div>
<div class="line"><span class="lineno">  121</span>   <span class="keywordtype">int</span> icheck = 5; <span class="comment">//How often are configurations saved</span></div>
<div class="line"><span class="lineno">  122</span>   <span class="keywordtype">int</span> ibound = -1;</div>
<div class="line"><span class="lineno">  123</span><span class="preprocessor">#ifdef USE_MATH_DEFINES</span></div>
<div class="line"><span class="lineno">  124</span>   <span class="keyword">const</span> <span class="keywordtype">double</span> tpi = 2*<a class="code hl_define" href="random_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;</div>
<div class="line"><span class="lineno">  125</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  126</span>   <span class="keyword">const</span> <span class="keywordtype">double</span> tpi = 2*acos(-1.0);</div>
<div class="line"><span class="lineno">  127</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  128</span>   <span class="keywordtype">float</span> dt=0.004;   <span class="keywordtype">float</span> ajq = 0.0;  <span class="keywordtype">float</span> delb=0; <span class="comment">//Not used?</span></div>
<div class="line"><span class="lineno">  129</span>   <span class="keywordtype">float</span> athq = 0.0; <span class="keywordtype">int</span> stepl = 250;  <span class="keywordtype">int</span> ntraj = 10;</div>
<div class="line"><span class="lineno">  130</span>   <span class="comment">//rank is zero means it must be the &quot;master process&quot;</span></div>
<div class="line"><span class="lineno">  131</span>   <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>){</div>
<div class="line"><span class="lineno">  132</span>      FILE *midout;</div>
<div class="line"><span class="lineno">  133</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *filename = (argc!=2) ?<span class="stringliteral">&quot;midout&quot;</span>:argv[1];</div>
<div class="line"><span class="lineno">  134</span>      <span class="keywordtype">char</span> *fileop = <span class="stringliteral">&quot;r&quot;</span>;</div>
<div class="line"><span class="lineno">  135</span>      <span class="keywordflow">if</span>( !(midout = fopen(filename, fileop) ) ){</div>
<div class="line"><span class="lineno">  136</span>         fprintf(stderr, <span class="stringliteral">&quot;Error %i in %s: Failed to open file %s for %s.\nExiting\n\n&quot;</span>,\</div>
<div class="line"><span class="lineno">  137</span>               OPENERROR, funcname, filename, fileop);</div>
<div class="line"><span class="lineno">  138</span><span class="preprocessor">#if(nproc&gt;1)</span></div>
<div class="line"><span class="lineno">  139</span>         MPI_Abort(comm,OPENERROR);</div>
<div class="line"><span class="lineno">  140</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  141</span>         exit(OPENERROR);</div>
<div class="line"><span class="lineno">  142</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  143</span>      }</div>
<div class="line"><span class="lineno">  144</span>      <span class="comment">//See the README for what each entry means</span></div>
<div class="line"><span class="lineno">  145</span>      fscanf(midout, <span class="stringliteral">&quot;%f %f %f %f %f %f %f %d %d %d %d %d&quot;</span>, &amp;dt, &amp;beta, &amp;akappa,\</div>
<div class="line"><span class="lineno">  146</span>            &amp;ajq, &amp;athq, &amp;fmu, &amp;delb, &amp;stepl, &amp;ntraj, &amp;istart, &amp;icheck, &amp;iread);</div>
<div class="line"><span class="lineno">  147</span>      fclose(midout);</div>
<div class="line"><span class="lineno">  148</span>      assert(stepl&gt;0);  assert(ntraj&gt;0);    assert(istart&gt;=0);  assert(icheck&gt;0);  assert(iread&gt;=0); </div>
<div class="line"><span class="lineno">  149</span>   }</div>
<div class="line"><span class="lineno">  150</span>   <span class="comment">//Send inputs to other ranks</span></div>
<div class="line"><span class="lineno">  151</span><span class="preprocessor">#if(nproc&gt;1)</span></div>
<div class="line"><span class="lineno">  152</span>   <a class="code hl_function" href="par__mpi_8h.html#a31e5f4f36c6e583903e8dd06dbf76fc6">Par_fcopy</a>(&amp;dt); <a class="code hl_function" href="par__mpi_8h.html#a31e5f4f36c6e583903e8dd06dbf76fc6">Par_fcopy</a>(&amp;beta); <a class="code hl_function" href="par__mpi_8h.html#a31e5f4f36c6e583903e8dd06dbf76fc6">Par_fcopy</a>(&amp;akappa); <a class="code hl_function" href="par__mpi_8h.html#a31e5f4f36c6e583903e8dd06dbf76fc6">Par_fcopy</a>(&amp;ajq);</div>
<div class="line"><span class="lineno">  153</span>   <a class="code hl_function" href="par__mpi_8h.html#a31e5f4f36c6e583903e8dd06dbf76fc6">Par_fcopy</a>(&amp;athq); <a class="code hl_function" href="par__mpi_8h.html#a31e5f4f36c6e583903e8dd06dbf76fc6">Par_fcopy</a>(&amp;fmu); <a class="code hl_function" href="par__mpi_8h.html#a31e5f4f36c6e583903e8dd06dbf76fc6">Par_fcopy</a>(&amp;delb); <span class="comment">//Not used?</span></div>
<div class="line"><span class="lineno">  154</span>   <a class="code hl_function" href="par__mpi_8h.html#a82049c8a7fcf726d3b222e4fedf6f674">Par_icopy</a>(&amp;stepl); <a class="code hl_function" href="par__mpi_8h.html#a82049c8a7fcf726d3b222e4fedf6f674">Par_icopy</a>(&amp;ntraj); <a class="code hl_function" href="par__mpi_8h.html#a82049c8a7fcf726d3b222e4fedf6f674">Par_icopy</a>(&amp;istart); <a class="code hl_function" href="par__mpi_8h.html#a82049c8a7fcf726d3b222e4fedf6f674">Par_icopy</a>(&amp;icheck);</div>
<div class="line"><span class="lineno">  155</span>   <a class="code hl_function" href="par__mpi_8h.html#a82049c8a7fcf726d3b222e4fedf6f674">Par_icopy</a>(&amp;iread); </div>
<div class="line"><span class="lineno">  156</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  157</span>   jqq=ajq*cexp(athq*I);</div>
<div class="line"><span class="lineno">  158</span>   <span class="comment">//End of input</span></div>
<div class="line"><span class="lineno">  159</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  160</span>   <span class="comment">//CUBLAS Handle</span></div>
<div class="line"><span class="lineno">  161</span>   cublasCreate(&amp;cublas_handle);</div>
<div class="line"><span class="lineno">  162</span>   <span class="comment">//Set up grid and blocks</span></div>
<div class="line"><span class="lineno">  163</span>   blockInit(<a class="code hl_define" href="sizes_8h.html#a20074569426d76a5518d4fc993f39687">nx</a>, <a class="code hl_define" href="sizes_8h.html#af50d69158019ca2b0261d76bc7a0e068">ny</a>, <a class="code hl_define" href="sizes_8h.html#aec60cd5d26e4c776029f09306fee4ac4">nz</a>, <a class="code hl_define" href="sizes_8h.html#a0a16c4ba7a97b8fbe2b7cafe00dc7896">nt</a>, &amp;dimBlock, &amp;dimGrid);</div>
<div class="line"><span class="lineno">  164</span>   <span class="comment">//CUDA device</span></div>
<div class="line"><span class="lineno">  165</span>   <span class="keywordtype">int</span> device=-1;</div>
<div class="line"><span class="lineno">  166</span>   cudaGetDevice(&amp;device);</div>
<div class="line"><span class="lineno">  167</span>   <span class="comment">//For asynchronous memory, when CUDA syncs any unused memory in the pool is released back to the OS</span></div>
<div class="line"><span class="lineno">  168</span>   <span class="comment">//unless a threshold is given. We&#39;ll base our threshold off of Congradq</span></div>
<div class="line"><span class="lineno">  169</span>   cudaDeviceGetDefaultMemPool(&amp;mempool, device);</div>
<div class="line"><span class="lineno">  170</span>   <span class="keywordtype">int</span> threshold=2*<a class="code hl_define" href="sizes_8h.html#ad0a75cc73930f4f3c147efd824764b07">kferm2</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>);</div>
<div class="line"><span class="lineno">  171</span>   cudaMemPoolSetAttribute(mempool, cudaMemPoolAttrReleaseThreshold, &amp;threshold);</div>
<div class="line"><span class="lineno">  172</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  173</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  174</span>   printf(<span class="stringliteral">&quot;jqq=%f+(%f)I\n&quot;</span>,creal(jqq),cimag(jqq));</div>
<div class="line"><span class="lineno">  175</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  176</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  177</span>   <a class="code hl_variable" href="random_8h.html#affb5f34f39f7103b999d198b18ffed8e">seed</a> = 967580161;</div>
<div class="line"><span class="lineno">  178</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  179</span>   <a class="code hl_variable" href="random_8h.html#affb5f34f39f7103b999d198b18ffed8e">seed</a> = time(NULL);</div>
<div class="line"><span class="lineno">  180</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>   <span class="comment">//Gauge, trial and momentum fields </span></div>
<div class="line"><span class="lineno">  183</span>   <span class="comment">//You&#39;ll notice that there are two different allocation/free statements</span></div>
<div class="line"><span class="lineno">  184</span>   <span class="comment">//One for CUDA and one for everything else depending on what&#39;s</span></div>
<div class="line"><span class="lineno">  185</span>   <span class="comment">//being used</span></div>
<div class="line"><span class="lineno">  186</span><span class="comment">   /***  Let&#39;s take a quick moment to compare this to the analysis code.</span></div>
<div class="line"><span class="lineno">  187</span><span class="comment">    * The analysis code stores the gauge field as a 4 component real valued vector, whereas the produciton code</span></div>
<div class="line"><span class="lineno">  188</span><span class="comment">    * used two complex numbers.</span></div>
<div class="line"><span class="lineno">  189</span><span class="comment">    *</span></div>
<div class="line"><span class="lineno">  190</span><span class="comment">    * Analysis code: u=(Re(u[0]),Im(u[1]),Re(u[1]),Im(u[0]))</span></div>
<div class="line"><span class="lineno">  191</span><span class="comment">    * Production code: u[0]=u[0]+I*u[3]   u[1]=u[2]+I*u[1]</span></div>
<div class="line"><span class="lineno">  192</span><span class="comment">    *</span></div>
<div class="line"><span class="lineno">  193</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">  194</span>   <a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a> *u[2], *ut[2];</div>
<div class="line"><span class="lineno">  195</span>   <a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a> *ut_f[2];</div>
<div class="line"><span class="lineno">  196</span>   <span class="keywordtype">double</span> *dk[2], *pp;</div>
<div class="line"><span class="lineno">  197</span>   <span class="keywordtype">float</span> *dk_f[2];</div>
<div class="line"><span class="lineno">  198</span>   <span class="comment">//Halo index arrays</span></div>
<div class="line"><span class="lineno">  199</span>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *iu, *id;</div>
<div class="line"><span class="lineno">  200</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  201</span>   cudaMallocManaged((<span class="keywordtype">void</span>**)&amp;iu,<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  202</span>   cudaMallocManaged((<span class="keywordtype">void</span>**)&amp;<span class="keywordtype">id</span>,<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  203</span> </div>
<div class="line"><span class="lineno">  204</span>   cudaMallocManaged(&amp;dk[0],(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  205</span>   cudaMallocManaged(&amp;dk[1],(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  206</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  207</span>   cudaMallocManaged(&amp;dk_f[0],(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  208</span>   cudaMallocManaged(&amp;dk_f[1],(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  209</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  210</span>   cudaMalloc(&amp;dk_f[0],(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><span class="lineno">  211</span>   cudaMalloc(&amp;dk_f[1],(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><span class="lineno">  212</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  213</span> </div>
<div class="line"><span class="lineno">  214</span>   <span class="keywordtype">int</span>   *gamin;</div>
<div class="line"><span class="lineno">  215</span>   <a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a> *gamval;</div>
<div class="line"><span class="lineno">  216</span>   <a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a> *gamval_f;</div>
<div class="line"><span class="lineno">  217</span>   cudaMallocManaged(&amp;gamin,4*4*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  218</span>   cudaMallocManaged(&amp;gamval,5*4*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  219</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  220</span>   cudaMallocManaged(&amp;gamval_f,5*4*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  221</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  222</span>   cudaMalloc(&amp;gamval_f,5*4*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>));</div>
<div class="line"><span class="lineno">  223</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  224</span>   cudaMallocManaged(&amp;u[0],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  225</span>   cudaMallocManaged(&amp;u[1],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  226</span>   cudaMallocManaged(&amp;ut[0],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  227</span>   cudaMallocManaged(&amp;ut[1],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  228</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  229</span>   cudaMallocManaged(&amp;ut_f[0],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  230</span>   cudaMallocManaged(&amp;ut_f[1],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  231</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  232</span>   cudaMalloc(&amp;ut_f[0],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>));</div>
<div class="line"><span class="lineno">  233</span>   cudaMalloc(&amp;ut_f[1],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>));</div>
<div class="line"><span class="lineno">  234</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  235</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  236</span>   <span class="keywordtype">id</span> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*)aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><span class="lineno">  237</span>   iu = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*)aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><span class="lineno">  238</span> </div>
<div class="line"><span class="lineno">  239</span>   <span class="keywordtype">int</span>   *gamin = (<span class="keywordtype">int</span> *)aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,4*4*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><span class="lineno">  240</span>   <a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a> *gamval=(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a> *)aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,5*4*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  241</span>   <a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a> *gamval_f=(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a> *)aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,5*4*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>));;</div>
<div class="line"><span class="lineno">  242</span> </div>
<div class="line"><span class="lineno">  243</span>   dk[0] = (<span class="keywordtype">double</span> *)aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><span class="lineno">  244</span>   dk[1] = (<span class="keywordtype">double</span> *)aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><span class="lineno">  245</span>   dk_f[0] = (<span class="keywordtype">float</span> *)aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><span class="lineno">  246</span>   dk_f[1] = (<span class="keywordtype">float</span> *)aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><span class="lineno">  247</span> </div>
<div class="line"><span class="lineno">  248</span>   u[0] = (<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a> *)aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  249</span>   u[1] = (<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a> *)aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  250</span>   ut[0] = (<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a> *)aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  251</span>   ut[1] = (<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a> *)aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  252</span>   ut_f[0] = (<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a> *)aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>));</div>
<div class="line"><span class="lineno">  253</span>   ut_f[1] = (<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a> *)aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*(<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>+<a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>)*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>));</div>
<div class="line"><span class="lineno">  254</span><span class="preprocessor">#endif</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">  268</span>   <a class="code hl_function" href="su2hmc_8h.html#a84f252348f913fcc70ce5de0aab6f8bf">Init</a>(istart,ibound,iread,beta,fmu,akappa,ajq,u,ut,ut_f,gamval,gamval_f,gamin,dk,dk_f,iu,<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  269</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  270</span>   <span class="comment">//GPU Initialisation stuff</span></div>
<div class="line"><span class="lineno">  271</span>   Init_CUDA(ut[0],ut[1],gamval,gamval_f,gamin,dk[0],dk[1],iu,<span class="keywordtype">id</span>);<span class="comment">//&amp;dimBlock,&amp;dimGrid);</span></div>
<div class="line"><span class="lineno">  272</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  273</span>   <span class="comment">//Send trials to accelerator for reunitarisation</span></div>
<div class="line"><span class="lineno">  274</span>   <a class="code hl_function" href="su2hmc_8h.html#ab3c213bd9acb695d1ed852737e5b750c">Reunitarise</a>(ut);</div>
<div class="line"><span class="lineno">  275</span>   <span class="comment">//Get trials back</span></div>
<div class="line"><span class="lineno">  276</span>   memcpy(u[0], ut[0], <a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  277</span>   memcpy(u[1], ut[1], <a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  278</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  279</span>   <span class="comment">//Flip all the gauge fields around so memory is coalesced</span></div>
<div class="line"><span class="lineno">  280</span>   Transpose_z(ut[0],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>,<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>);</div>
<div class="line"><span class="lineno">  281</span>   Transpose_z(ut[1],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>,<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>);</div>
<div class="line"><span class="lineno">  282</span>   <span class="comment">//And the index arrays</span></div>
<div class="line"><span class="lineno">  283</span>   Transpose_U(iu,<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>,<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>);</div>
<div class="line"><span class="lineno">  284</span>   Transpose_U(<span class="keywordtype">id</span>,<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>,<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>);</div>
<div class="line"><span class="lineno">  285</span>   cudaDeviceSynchronise();</div>
<div class="line"><span class="lineno">  286</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  287</span><span class="preprocessor">#ifdef DIAGNOSTIC</span></div>
<div class="line"><span class="lineno">  288</span>   <span class="keywordtype">double</span> ancg_diag=0;</div>
<div class="line"><span class="lineno">  289</span>   Diagnostics(istart, u[0], u[1], ut[0], ut[1], ut_f[0], ut_f[1], iu, <span class="keywordtype">id</span>, <a class="code hl_variable" href="coord_8h.html#ac76e1a2ca235d93f69e04f74aad64e03">hu</a>, <a class="code hl_variable" href="coord_8h.html#abbd8034942e42e0aa8c94a756d616e2d">hd</a>, dk[0], dk[1],\</div>
<div class="line"><span class="lineno">  290</span>         dk_f[0], dk_f[1], gamin, gamval, gamval_f, jqq, akappa, beta, ancg_diag);</div>
<div class="line"><span class="lineno">  291</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  292</span> </div>
<div class="line"><span class="lineno">  293</span>   <span class="comment">//Initial Measurements</span></div>
<div class="line"><span class="lineno">  294</span>   <span class="comment">//====================</span></div>
<div class="line"><span class="lineno">  295</span>   <a class="code hl_function" href="par__mpi_8h.html#abf4867774abbc820eb4aaaeabbee31f4">Trial_Exchange</a>(ut,ut_f);</div>
<div class="line"><span class="lineno">  296</span>   <span class="keywordtype">double</span> poly = <a class="code hl_function" href="su2hmc_8h.html#a247c28a831d22009693ea8465b3f99cd">Polyakov</a>(ut_f);</div>
<div class="line"><span class="lineno">  297</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  298</span>   <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;Initial Polyakov loop evaluated as %e\n&quot;</span>, poly);</div>
<div class="line"><span class="lineno">  299</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  300</span>   <span class="keywordtype">double</span> hg, avplaqs, avplaqt;</div>
<div class="line"><span class="lineno">  301</span>   <span class="comment">//Halo exchange of the trial fields</span></div>
<div class="line"><span class="lineno">  302</span>   <a class="code hl_function" href="su2hmc_8h.html#a2c38affebb6d51c6132aedeb69e2c46e">Average_Plaquette</a>(&amp;hg,&amp;avplaqs,&amp;avplaqt,ut_f,iu,beta);</div>
<div class="line"><span class="lineno">  303</span>   <span class="comment">//Trajectory length</span></div>
<div class="line"><span class="lineno">  304</span>   <span class="keywordtype">double</span> traj=stepl*dt;</div>
<div class="line"><span class="lineno">  305</span>   <span class="comment">//Acceptance probability</span></div>
<div class="line"><span class="lineno">  306</span>   <span class="keywordtype">double</span> proby = 2.5/stepl;</div>
<div class="line"><span class="lineno">  307</span>   <span class="keywordtype">char</span> suffix[<a class="code hl_define" href="sizes_8h.html#ab5757303b45686827c94c395603817af">FILELEN</a>]=<span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno">  308</span>   <span class="keywordtype">int</span> buffer; <span class="keywordtype">char</span> buff2[7];</div>
<div class="line"><span class="lineno">  309</span>   <span class="comment">//Add script for extracting correct mu, j etc.</span></div>
<div class="line"><span class="lineno">  310</span>   buffer = (int)round(100*beta);</div>
<div class="line"><span class="lineno">  311</span>   sprintf(buff2,<span class="stringliteral">&quot;b%03d&quot;</span>,buffer);</div>
<div class="line"><span class="lineno">  312</span>   strcat(suffix,buff2);</div>
<div class="line"><span class="lineno">  313</span>   <span class="comment">//κ</span></div>
<div class="line"><span class="lineno">  314</span>   buffer = (int)round(10000*akappa);</div>
<div class="line"><span class="lineno">  315</span>   sprintf(buff2,<span class="stringliteral">&quot;k%04d&quot;</span>,buffer);</div>
<div class="line"><span class="lineno">  316</span>   strcat(suffix,buff2);</div>
<div class="line"><span class="lineno">  317</span>   <span class="comment">//μ</span></div>
<div class="line"><span class="lineno">  318</span>   buffer = (int)round(1000*fmu);</div>
<div class="line"><span class="lineno">  319</span>   sprintf(buff2,<span class="stringliteral">&quot;mu%04d&quot;</span>,buffer);</div>
<div class="line"><span class="lineno">  320</span>   strcat(suffix,buff2);</div>
<div class="line"><span class="lineno">  321</span>   <span class="comment">//J</span></div>
<div class="line"><span class="lineno">  322</span>   buffer = (int)round(1000*ajq);</div>
<div class="line"><span class="lineno">  323</span>   sprintf(buff2,<span class="stringliteral">&quot;j%03d&quot;</span>,buffer);</div>
<div class="line"><span class="lineno">  324</span>   strcat(suffix,buff2);</div>
<div class="line"><span class="lineno">  325</span>   <span class="comment">//nx</span></div>
<div class="line"><span class="lineno">  326</span>   sprintf(buff2,<span class="stringliteral">&quot;s%02d&quot;</span>,<a class="code hl_define" href="sizes_8h.html#a20074569426d76a5518d4fc993f39687">nx</a>);</div>
<div class="line"><span class="lineno">  327</span>   strcat(suffix,buff2);</div>
<div class="line"><span class="lineno">  328</span>   <span class="comment">//nt</span></div>
<div class="line"><span class="lineno">  329</span>   sprintf(buff2,<span class="stringliteral">&quot;t%02d&quot;</span>,<a class="code hl_define" href="sizes_8h.html#a0a16c4ba7a97b8fbe2b7cafe00dc7896">nt</a>);</div>
<div class="line"><span class="lineno">  330</span>   strcat(suffix,buff2);</div>
<div class="line"><span class="lineno">  331</span>   <span class="keywordtype">char</span> outname[<a class="code hl_define" href="sizes_8h.html#ab5757303b45686827c94c395603817af">FILELEN</a>] = <span class="stringliteral">&quot;Output.&quot;</span>; <span class="keywordtype">char</span> *outop=<span class="stringliteral">&quot;a&quot;</span>;</div>
<div class="line"><span class="lineno">  332</span>   strcat(outname,suffix);</div>
<div class="line"><span class="lineno">  333</span>   FILE *output;</div>
<div class="line"><span class="lineno">  334</span>   <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>){</div>
<div class="line"><span class="lineno">  335</span>      <span class="keywordflow">if</span>(!(output=fopen(outname, outop) )){</div>
<div class="line"><span class="lineno">  336</span>         fprintf(stderr,<span class="stringliteral">&quot;Error %i in %s: Failed to open file %s for %s.\nExiting\n\n&quot;</span>,OPENERROR,funcname,outname,outop);</div>
<div class="line"><span class="lineno">  337</span><span class="preprocessor">#if(nproc&gt;1)</span></div>
<div class="line"><span class="lineno">  338</span>         MPI_Abort(comm,OPENERROR);</div>
<div class="line"><span class="lineno">  339</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  340</span>         exit(OPENERROR);</div>
<div class="line"><span class="lineno">  341</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  342</span>      }</div>
<div class="line"><span class="lineno">  343</span>      printf(<span class="stringliteral">&quot;hg = %e, &lt;Ps&gt; = %e, &lt;Pt&gt; = %e, &lt;Poly&gt; = %e\n&quot;</span>, hg, avplaqs, avplaqt, poly);</div>
<div class="line"><span class="lineno">  344</span>      fprintf(output, <span class="stringliteral">&quot;ksize = %i ksizet = %i Nf = %i Halo =%i\nTime step dt = %e Trajectory length = %e\n&quot;</span>\</div>
<div class="line"><span class="lineno">  345</span>            <span class="stringliteral">&quot;No. of Trajectories = %i β = %e\nκ = %e μ = %e\nDiquark source = %e Diquark phase angle = %e\n&quot;</span>\</div>
<div class="line"><span class="lineno">  346</span>            <span class="stringliteral">&quot;Stopping Residuals: Guidance: %e Acceptance: %e, Estimator: %e\nSeed = %ld\n&quot;</span>,</div>
<div class="line"><span class="lineno">  347</span>            <a class="code hl_define" href="sizes_8h.html#a8fdb352cd20ab9414865284587408ca5">ksize</a>, <a class="code hl_define" href="sizes_8h.html#a30eff51e2a98ccced567ec489032aabd">ksizet</a>, <a class="code hl_define" href="sizes_8h.html#a96392c5c7e198251a7efacba03414393">nf</a>, <a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>, dt, traj, ntraj, beta, akappa, fmu, ajq, athq, <a class="code hl_define" href="sizes_8h.html#a093a588ccbffef2360dc858ed61389b1">rescgg</a>, <a class="code hl_define" href="sizes_8h.html#a770f33f0e08f9a5b2ff02791efef03a7">rescga</a>, <a class="code hl_define" href="sizes_8h.html#aadcdbf20ae08c6005b8972433a4e3aaa">respbp</a>, <a class="code hl_variable" href="random_8h.html#affb5f34f39f7103b999d198b18ffed8e">seed</a>);</div>
<div class="line"><span class="lineno">  348</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  349</span>      <span class="comment">//Print to terminal during debugging</span></div>
<div class="line"><span class="lineno">  350</span>      printf(<span class="stringliteral">&quot;ksize = %i ksizet = %i Nf = %i Halo = %i\nTime step dt = %e Trajectory length = %e\n&quot;</span>\</div>
<div class="line"><span class="lineno">  351</span>            <span class="stringliteral">&quot;No. of Trajectories = %i β = %e\nκ = %e μ = %e\nDiquark source = %e Diquark phase angle = %e\n&quot;</span>\</div>
<div class="line"><span class="lineno">  352</span>            <span class="stringliteral">&quot;Stopping Residuals: Guidance: %e Acceptance: %e, Estimator: %e\nSeed = %ld\n&quot;</span>,</div>
<div class="line"><span class="lineno">  353</span>            <a class="code hl_define" href="sizes_8h.html#a8fdb352cd20ab9414865284587408ca5">ksize</a>, <a class="code hl_define" href="sizes_8h.html#a30eff51e2a98ccced567ec489032aabd">ksizet</a>, <a class="code hl_define" href="sizes_8h.html#a96392c5c7e198251a7efacba03414393">nf</a>, <a class="code hl_define" href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a>, dt, traj, ntraj, beta, akappa, fmu, ajq, athq, <a class="code hl_define" href="sizes_8h.html#a093a588ccbffef2360dc858ed61389b1">rescgg</a>, <a class="code hl_define" href="sizes_8h.html#a770f33f0e08f9a5b2ff02791efef03a7">rescga</a>, <a class="code hl_define" href="sizes_8h.html#aadcdbf20ae08c6005b8972433a4e3aaa">respbp</a>, <a class="code hl_variable" href="random_8h.html#affb5f34f39f7103b999d198b18ffed8e">seed</a>);</div>
<div class="line"><span class="lineno">  354</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  355</span>   }</div>
<div class="line"><span class="lineno">  356</span>   <span class="comment">//Initialise for averages</span></div>
<div class="line"><span class="lineno">  357</span>   <span class="comment">//======================</span></div>
<div class="line"><span class="lineno">  358</span>   <span class="keywordtype">double</span> actiona = 0.0; <span class="keywordtype">double</span> vel2a = 0.0; <span class="keywordtype">double</span> pbpa = 0.0; <span class="keywordtype">double</span> endenfa = 0.0; <span class="keywordtype">double</span> denfa = 0.0;</div>
<div class="line"><span class="lineno">  359</span>   <span class="comment">//Expected canged in Hamiltonian</span></div>
<div class="line"><span class="lineno">  360</span>   <span class="keywordtype">double</span> e_dH=0; <span class="keywordtype">double</span> e_dH_e=0;</div>
<div class="line"><span class="lineno">  361</span>   <span class="comment">//Expected Metropolis accept probability. Skewed by cases where the hamiltonian decreases.</span></div>
<div class="line"><span class="lineno">  362</span>   <span class="keywordtype">double</span> yav = 0.0; <span class="keywordtype">double</span> yyav = 0.0; </div>
<div class="line"><span class="lineno">  363</span> </div>
<div class="line"><span class="lineno">  364</span>   <span class="keywordtype">int</span> naccp = 0; <span class="keywordtype">int</span> ipbp = 0; <span class="keywordtype">int</span> itot = 0;</div>
<div class="line"><span class="lineno">  365</span> </div>
<div class="line"><span class="lineno">  366</span>   <span class="comment">//Start of classical evolution</span></div>
<div class="line"><span class="lineno">  367</span>   <span class="comment">//===========================</span></div>
<div class="line"><span class="lineno">  368</span>   <span class="keywordtype">double</span> pbp;</div>
<div class="line"><span class="lineno">  369</span>   <a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a> qq;</div>
<div class="line"><span class="lineno">  370</span>   <span class="keywordtype">double</span> *dSdpi;</div>
<div class="line"><span class="lineno">  371</span>   <span class="comment">//Field and related declarations</span></div>
<div class="line"><span class="lineno">  372</span>   <a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a> *Phi, *R1, *X0, *X1;</div>
<div class="line"><span class="lineno">  373</span>   <span class="comment">//Initialise Arrays. Leaving it late for scoping</span></div>
<div class="line"><span class="lineno">  374</span>   <span class="comment">//check the sizes in sizes.h</span></div>
<div class="line"><span class="lineno">  375</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  376</span>   cudaMallocManaged(&amp;R1, <a class="code hl_define" href="sizes_8h.html#ae64a9369483ee854867cfa822c94bfd1">kfermHalo</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  377</span>   cudaMalloc(&amp;Phi, <a class="code hl_define" href="sizes_8h.html#a96392c5c7e198251a7efacba03414393">nf</a>*<a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  378</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  379</span>   cudaMallocManaged(&amp;X0, <a class="code hl_define" href="sizes_8h.html#a96392c5c7e198251a7efacba03414393">nf</a>*<a class="code hl_define" href="sizes_8h.html#ad0a75cc73930f4f3c147efd824764b07">kferm2</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  380</span>   cudaMallocManaged(&amp;dSdpi, <a class="code hl_define" href="sizes_8h.html#a1f2e85d0eeb03e194221160b0acadd81">kmom</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  381</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  382</span>   cudaMalloc(&amp;X0, <a class="code hl_define" href="sizes_8h.html#a96392c5c7e198251a7efacba03414393">nf</a>*<a class="code hl_define" href="sizes_8h.html#ad0a75cc73930f4f3c147efd824764b07">kferm2</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  383</span>   cudaMalloc(&amp;dSdpi, <a class="code hl_define" href="sizes_8h.html#a1f2e85d0eeb03e194221160b0acadd81">kmom</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><span class="lineno">  384</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  385</span> </div>
<div class="line"><span class="lineno">  386</span>   cudaMallocManaged(&amp;X1, <a class="code hl_define" href="sizes_8h.html#a36126fb9c56da5fb6713943ca7ea3264">kferm2Halo</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  387</span>   cudaMallocManaged(&amp;pp, <a class="code hl_define" href="sizes_8h.html#a1f2e85d0eeb03e194221160b0acadd81">kmom</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  388</span>   cudaDeviceSynchronise();</div>
<div class="line"><span class="lineno">  389</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  390</span>   R1= aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#ae64a9369483ee854867cfa822c94bfd1">kfermHalo</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  391</span>   Phi= aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#a96392c5c7e198251a7efacba03414393">nf</a>*<a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>)); </div>
<div class="line"><span class="lineno">  392</span>   X0= aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#a96392c5c7e198251a7efacba03414393">nf</a>*<a class="code hl_define" href="sizes_8h.html#ad0a75cc73930f4f3c147efd824764b07">kferm2</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>)); </div>
<div class="line"><span class="lineno">  393</span>   X1= aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#a36126fb9c56da5fb6713943ca7ea3264">kferm2Halo</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>)); </div>
<div class="line"><span class="lineno">  394</span>   dSdpi = aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#a1f2e85d0eeb03e194221160b0acadd81">kmom</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><span class="lineno">  395</span>   <span class="comment">//pp is the momentum field</span></div>
<div class="line"><span class="lineno">  396</span>   pp = aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#a1f2e85d0eeb03e194221160b0acadd81">kmom</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><span class="lineno">  397</span><span class="preprocessor">#endif</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">  403</span><span class="preprocessor">#if (defined SA3AT)</span></div>
<div class="line"><span class="lineno">  404</span>   <span class="keywordtype">double</span> start_time=0;</div>
<div class="line"><span class="lineno">  405</span>   <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>){</div>
<div class="line"><span class="lineno">  406</span><span class="preprocessor">#if(nproc&gt;1)</span></div>
<div class="line"><span class="lineno">  407</span>      start_time = MPI_Wtime();</div>
<div class="line"><span class="lineno">  408</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  409</span>      start_time = omp_get_wtime();</div>
<div class="line"><span class="lineno">  410</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  411</span>   }</div>
<div class="line"><span class="lineno">  412</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  413</span>   <span class="keywordtype">double</span> action;</div>
<div class="line"><span class="lineno">  414</span>   <span class="comment">//Conjugate Gradient iteration counters</span></div>
<div class="line"><span class="lineno">  415</span>   <span class="keywordtype">double</span> ancg,ancgh,totancg,totancgh=0;</div>
<div class="line"><span class="lineno">  416</span>   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itraj = iread+1; itraj &lt;= ntraj+iread; itraj++){</div>
<div class="line"><span class="lineno">  417</span>      <span class="comment">//Reset conjugate gradient averages</span></div>
<div class="line"><span class="lineno">  418</span>      ancg = 0; ancgh = 0;</div>
<div class="line"><span class="lineno">  419</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  420</span>      <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>)</div>
<div class="line"><span class="lineno">  421</span>         printf(<span class="stringliteral">&quot;Starting itraj %i\n&quot;</span>, itraj);</div>
<div class="line"><span class="lineno">  422</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  423</span>      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> na=0; na&lt;<a class="code hl_define" href="sizes_8h.html#a96392c5c7e198251a7efacba03414393">nf</a>; na++){</div>
<div class="line"><span class="lineno">  424</span>         <span class="comment">//Probably makes sense to declare this outside the loop</span></div>
<div class="line"><span class="lineno">  425</span>         <span class="comment">//but I do like scoping/don&#39;t want to break anything else just teat</span></div>
<div class="line"><span class="lineno">  426</span>         <span class="comment">//</span></div>
<div class="line"><span class="lineno">  427</span>         <span class="comment">//How do we optimise this for use in CUDA? Do we use CUDA&#39;s PRNG</span></div>
<div class="line"><span class="lineno">  428</span>         <span class="comment">//or stick with MKL and synchronise/copy over the array</span></div>
<div class="line"><span class="lineno">  429</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  430</span>         <a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a> *R1_f,*R;</div>
<div class="line"><span class="lineno">  431</span>         cudaMallocManaged(&amp;R,<a class="code hl_define" href="sizes_8h.html#ae64a9369483ee854867cfa822c94bfd1">kfermHalo</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  432</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  433</span>         cudaMallocManaged(&amp;R1_f,<a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>),cudaMemAttachGlobal);</div>
<div class="line"><span class="lineno">  434</span>         cudaMemset(R1_f,0,<a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>));</div>
<div class="line"><span class="lineno">  435</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  436</span>         cudaMallocAsync(&amp;R1_f,<a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>),streams[0]);</div>
<div class="line"><span class="lineno">  437</span>         cudaMemsetAsync(R1_f,0,<a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>),streams[0]);</div>
<div class="line"><span class="lineno">  438</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  439</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  440</span>         <a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a> *R1_f=aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>));</div>
<div class="line"><span class="lineno">  441</span>         <a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a> *R=aligned_alloc(<a class="code hl_define" href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a>,<a class="code hl_define" href="sizes_8h.html#ae64a9369483ee854867cfa822c94bfd1">kfermHalo</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>));</div>
<div class="line"><span class="lineno">  442</span>         memset(R1_f,0,<a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>));</div>
<div class="line"><span class="lineno">  443</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  444</span>         <span class="comment">//The FORTRAN code had two Gaussian routines.</span></div>
<div class="line"><span class="lineno">  445</span>         <span class="comment">//gaussp was the normal Box-Muller and gauss0 didn&#39;t have 2 inside the square root</span></div>
<div class="line"><span class="lineno">  446</span>         <span class="comment">//Using σ=1/sqrt(2) in these routines has the same effect as gauss0</span></div>
<div class="line"><span class="lineno">  447</span><span class="preprocessor">#if (defined __NVCC__ &amp;&amp; defined _DEBUG)</span></div>
<div class="line"><span class="lineno">  448</span>         cudaMemPrefetchAsync(R1_f,<a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>),device,streams[1]);</div>
<div class="line"><span class="lineno">  449</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  450</span><span class="preprocessor">#if (defined(USE_RAN2)||defined(__RANLUX__)||!defined(__INTEL_MKL__))</span></div>
<div class="line"><span class="lineno">  451</span>         <a class="code hl_function" href="random_8h.html#a859e92fda23ce37dad2971362f72a50d">Gauss_c</a>(R, <a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>, 0, 1/sqrt(2));</div>
<div class="line"><span class="lineno">  452</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  453</span>         vsRngGaussian(VSL_RNG_METHOD_GAUSSIAN_ICDF, stream, 2*<a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>, R, 0, 1/sqrt(2));</div>
<div class="line"><span class="lineno">  454</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  455</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  456</span>         cudaMemPrefetchAsync(R,<a class="code hl_define" href="sizes_8h.html#ae64a9369483ee854867cfa822c94bfd1">kfermHalo</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a>),device,NULL);</div>
<div class="line"><span class="lineno">  457</span>         <span class="comment">//Transpose needed here for Dslashd</span></div>
<div class="line"><span class="lineno">  458</span>         Transpose_c(R,<a class="code hl_define" href="sizes_8h.html#a28cbc5ba47a8470a73965695f6a16542">ngorkov</a>*<a class="code hl_define" href="sizes_8h.html#a0845b4b004824f1fe3cd69db1672fa15">nc</a>,<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>);</div>
<div class="line"><span class="lineno">  459</span>         <span class="comment">//R is random so this techincally isn&#39;t required. But it does keep the code output consistent with previous</span></div>
<div class="line"><span class="lineno">  460</span>         <span class="comment">//versions.</span></div>
<div class="line"><span class="lineno">  461</span>         cudaDeviceSynchronise();</div>
<div class="line"><span class="lineno">  462</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  463</span>         <a class="code hl_function" href="matrices_8h.html#aeb1a49b42df431462e62cf11270a7131">Dslashd_f</a>(R1_f,R,ut_f[0],ut_f[1],iu,<span class="keywordtype">id</span>,gamval_f,gamin,dk_f,jqq,akappa);</div>
<div class="line"><span class="lineno">  464</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  465</span>         <span class="comment">//Make sure the multiplication is finished before freeing its input!!</span></div>
<div class="line"><span class="lineno">  466</span>         cudaFree(R);<span class="comment">//cudaDeviceSynchronise(); </span></div>
<div class="line"><span class="lineno">  467</span>                     <span class="comment">//cudaFree is blocking so don&#39;t need to synchronise</span></div>
<div class="line"><span class="lineno">  468</span>         cuComplex_convert(R1_f,R1,<a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>,<span class="keyword">false</span>,dimBlock,dimGrid);</div>
<div class="line"><span class="lineno">  469</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  470</span>         cudaFree(R1_f);</div>
<div class="line"><span class="lineno">  471</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  472</span>         cudaFreeAsync(R1_f,NULL);</div>
<div class="line"><span class="lineno">  473</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  474</span>         cudaMemcpyAsync(Phi+na*<a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>,R1, <a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>),cudaMemcpyDefault,NULL);</div>
<div class="line"><span class="lineno">  475</span>         <span class="comment">//cudaMemcpyAsync(Phi+na*kferm,R1, kferm*sizeof(Complex),cudaMemcpyDefault,streams[1]);</span></div>
<div class="line"><span class="lineno">  476</span>         cudaDeviceSynchronise();</div>
<div class="line"><span class="lineno">  477</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  478</span>         free(R); </div>
<div class="line"><span class="lineno">  479</span><span class="preprocessor">#pragma omp simd aligned(R1_f,R1:AVX)</span></div>
<div class="line"><span class="lineno">  480</span>         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>;i++)</div>
<div class="line"><span class="lineno">  481</span>            R1[i]=(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>)R1_f[i];</div>
<div class="line"><span class="lineno">  482</span>         free(R1_f);</div>
<div class="line"><span class="lineno">  483</span>         memcpy(Phi+na*<a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>,R1, <a class="code hl_define" href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  484</span>         <span class="comment">//Up/down partitioning (using only pseudofermions of flavour 1)</span></div>
<div class="line"><span class="lineno">  485</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  486</span>         UpDownPart(na, X0, R1);</div>
<div class="line"><span class="lineno">  487</span>      }  </div>
<div class="line"><span class="lineno">  488</span>      <span class="comment">//Heatbath</span></div>
<div class="line"><span class="lineno">  489</span>      <span class="comment">//========</span></div>
<div class="line"><span class="lineno">  490</span>      <span class="comment">//We&#39;re going to make the most of the new Gauss_d routine to send a flattened array</span></div>
<div class="line"><span class="lineno">  491</span>      <span class="comment">//and do this all in one step.</span></div>
<div class="line"><span class="lineno">  492</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  493</span>      cudaMemcpyAsync(ut[0], u[0], <a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>),cudaMemcpyHostToDevice,NULL);</div>
<div class="line"><span class="lineno">  494</span>      cudaMemcpyAsync(ut[1], u[1], <a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>),cudaMemcpyHostToDevice,NULL);</div>
<div class="line"><span class="lineno">  495</span>      <span class="comment">//Convert to SoA</span></div>
<div class="line"><span class="lineno">  496</span>      Transpose_z(ut[0],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>,<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>);</div>
<div class="line"><span class="lineno">  497</span>      Transpose_z(ut[1],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>,<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>);</div>
<div class="line"><span class="lineno">  498</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  499</span>      memcpy(ut[0], u[0], <a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  500</span>      memcpy(ut[1], u[1], <a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  501</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  502</span>      <a class="code hl_function" href="par__mpi_8h.html#abf4867774abbc820eb4aaaeabbee31f4">Trial_Exchange</a>(ut,ut_f);</div>
<div class="line"><span class="lineno">  503</span><span class="preprocessor">#if (defined(USE_RAN2)||defined(__RANLUX__)||!defined(__INTEL_MKL__))</span></div>
<div class="line"><span class="lineno">  504</span>      <a class="code hl_function" href="random_8h.html#aaaabdcbfe66bb65cb57139509f6ea496">Gauss_d</a>(pp, <a class="code hl_define" href="sizes_8h.html#a1f2e85d0eeb03e194221160b0acadd81">kmom</a>, 0, 1);</div>
<div class="line"><span class="lineno">  505</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  506</span>      vdRngGaussian(VSL_RNG_METHOD_GAUSSIAN_ICDF, stream, <a class="code hl_define" href="sizes_8h.html#a1f2e85d0eeb03e194221160b0acadd81">kmom</a>, pp, 0, 1);</div>
<div class="line"><span class="lineno">  507</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  508</span>      <span class="comment">//Initialise Trial Fields</span></div>
<div class="line"><span class="lineno">  509</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  510</span>      <span class="comment">//pp is random at this point so swapping the order isn&#39;t really necessary. But it does ensure that it matches for CPU and GPU</span></div>
<div class="line"><span class="lineno">  511</span>      Transpose_d(pp,<a class="code hl_define" href="sizes_8h.html#a55cdab879029c36c07fbd9e7e9b109c9">nadj</a>*<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>,<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>);</div>
<div class="line"><span class="lineno">  512</span>      cudaMemPrefetchAsync(pp,<a class="code hl_define" href="sizes_8h.html#a1f2e85d0eeb03e194221160b0acadd81">kmom</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),device,streams[1]);</div>
<div class="line"><span class="lineno">  513</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  514</span>      <span class="keywordtype">double</span> H0, S0;</div>
<div class="line"><span class="lineno">  515</span>      <a class="code hl_function" href="su2hmc_8h.html#aad654cdd6107120818d5485ce1620d81">Hamilton</a>(&amp;H0,&amp;S0,<a class="code hl_define" href="sizes_8h.html#a770f33f0e08f9a5b2ff02791efef03a7">rescga</a>,pp,X0,X1,Phi,ut_f,iu,<span class="keywordtype">id</span>,gamval_f,gamin,dk_f,jqq,akappa,beta,&amp;ancgh,itraj);</div>
<div class="line"><span class="lineno">  516</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  517</span>      <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;H0: %e S0: %e\n&quot;</span>, H0, S0);</div>
<div class="line"><span class="lineno">  518</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  519</span>      <span class="keywordflow">if</span>(itraj==1)</div>
<div class="line"><span class="lineno">  520</span>         action = S0/<a class="code hl_define" href="sizes_8h.html#aae3965888b92ccefd0fa4d96da415f65">gvol</a>;</div>
<div class="line"><span class="lineno">  521</span> </div>
<div class="line"><span class="lineno">  522</span>      <span class="comment">//Integration </span></div>
<div class="line"><span class="lineno">  523</span>      <span class="comment">//TODO: Have this as a runtime parameter.</span></div>
<div class="line"><span class="lineno">  524</span><span class="preprocessor">#if (defined INT_LPFR &amp;&amp; defined INT_OMF2) ||(defined INT_LPFR &amp;&amp; defined INT_OMF4)||(defined INT_OMF2 &amp;&amp; defined INT_OMF4)</span></div>
<div class="line"><span class="lineno">  525</span><span class="preprocessor">#error &quot;Only one integrator may be defined&quot;</span></div>
<div class="line"><span class="lineno">  526</span><span class="preprocessor">#elif defined INT_LPFR</span></div>
<div class="line"><span class="lineno">  527</span>      <a class="code hl_function" href="integrate_8h.html#a4d7f64e9f3e98a2953d707f18742d110">Leapfrog</a>(ut,ut_f,X0,X1,Phi,dk,dk_f,dSdpi,pp,iu,<span class="keywordtype">id</span>,gamval,gamval_f,gamin,jqq,beta,akappa,stepl,dt,&amp;ancg,&amp;itot,proby);</div>
<div class="line"><span class="lineno">  528</span><span class="preprocessor">#elif defined INT_OMF2</span></div>
<div class="line"><span class="lineno">  529</span>      <a class="code hl_function" href="integrate_8h.html#a33907d89c4a0709fcf809773de68c3a2">OMF2</a>(ut,ut_f,X0,X1,Phi,dk,dk_f,dSdpi,pp,iu,<span class="keywordtype">id</span>,gamval,gamval_f,gamin,jqq,beta,akappa,stepl,dt,&amp;ancg,&amp;itot,proby);</div>
<div class="line"><span class="lineno">  530</span><span class="preprocessor">#elif defined INT_OMF4</span></div>
<div class="line"><span class="lineno">  531</span>      <a class="code hl_function" href="integrate_8h.html#a4e6abc4e61c0131df30fb683569e5d00">OMF4</a>(ut,ut_f,X0,X1,Phi,dk,dk_f,dSdpi,pp,iu,<span class="keywordtype">id</span>,gamval,gamval_f,gamin,jqq,beta,akappa,stepl,dt,&amp;ancg,&amp;itot,proby);</div>
<div class="line"><span class="lineno">  532</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  533</span><span class="preprocessor">#error &quot;No integrator defined. Please define {INT_LPFR.INT_OMF2,INT_OMF4}&quot;</span></div>
<div class="line"><span class="lineno">  534</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  535</span> </div>
<div class="line"><span class="lineno">  536</span>      totancg+=ancg;</div>
<div class="line"><span class="lineno">  537</span>      <span class="comment">//Monte Carlo step: Accept new fields with the probability of min(1,exp(H0-X0))</span></div>
<div class="line"><span class="lineno">  538</span>      <span class="comment">//Kernel Call needed here?</span></div>
<div class="line"><span class="lineno">  539</span>      <a class="code hl_function" href="su2hmc_8h.html#ab3c213bd9acb695d1ed852737e5b750c">Reunitarise</a>(ut);</div>
<div class="line"><span class="lineno">  540</span>      <span class="keywordtype">double</span> H1, S1;</div>
<div class="line"><span class="lineno">  541</span>      <a class="code hl_function" href="su2hmc_8h.html#aad654cdd6107120818d5485ce1620d81">Hamilton</a>(&amp;H1,&amp;S1,<a class="code hl_define" href="sizes_8h.html#a770f33f0e08f9a5b2ff02791efef03a7">rescga</a>,pp,X0,X1,Phi,ut_f,iu,<span class="keywordtype">id</span>,gamval_f,gamin,dk_f,jqq,akappa,beta,&amp;ancgh,itraj);</div>
<div class="line"><span class="lineno">  542</span>      ancgh/=2.0; <span class="comment">//Hamilton is called at start and end of trajectory</span></div>
<div class="line"><span class="lineno">  543</span>      totancgh+=ancgh;</div>
<div class="line"><span class="lineno">  544</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  545</span>      printf(<span class="stringliteral">&quot;H0-H1=%f-%f&quot;</span>,H0,H1);</div>
<div class="line"><span class="lineno">  546</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  547</span>      <span class="keywordtype">double</span> dH = H0 - H1;</div>
<div class="line"><span class="lineno">  548</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  549</span>      printf(<span class="stringliteral">&quot;=%f\n&quot;</span>,dH);</div>
<div class="line"><span class="lineno">  550</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  551</span>      <span class="keywordtype">double</span> dS = S0 - S1;</div>
<div class="line"><span class="lineno">  552</span>      <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>){</div>
<div class="line"><span class="lineno">  553</span>         fprintf(output, <span class="stringliteral">&quot;dH = %e dS = %e\n&quot;</span>, dH, dS);</div>
<div class="line"><span class="lineno">  554</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  555</span>         printf(<span class="stringliteral">&quot;dH = %e dS = %e\n&quot;</span>, dH, dS);</div>
<div class="line"><span class="lineno">  556</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  557</span>      }</div>
<div class="line"><span class="lineno">  558</span>      e_dH+=dH; e_dH_e+=dH*dH;</div>
<div class="line"><span class="lineno">  559</span>      <span class="keywordtype">double</span> y = exp(dH);</div>
<div class="line"><span class="lineno">  560</span>      yav+=y;</div>
<div class="line"><span class="lineno">  561</span>      yyav+=y*y;</div>
<div class="line"><span class="lineno">  562</span>      <span class="comment">//The Monte-Carlo</span></div>
<div class="line"><span class="lineno">  563</span>      <span class="comment">//Always update  dH is positive (gone from higher to lower energy)</span></div>
<div class="line"><span class="lineno">  564</span>      <span class="keywordtype">bool</span> acc;</div>
<div class="line"><span class="lineno">  565</span>      <span class="keywordflow">if</span>(dH&gt;0 || <a class="code hl_function" href="random_8h.html#af30389dbea7d2b366abea7a923bb008d">Par_granf</a>()&lt;=y){</div>
<div class="line"><span class="lineno">  566</span>         <span class="comment">//Step is accepted. Set s=st</span></div>
<div class="line"><span class="lineno">  567</span>         <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>)</div>
<div class="line"><span class="lineno">  568</span>            printf(<span class="stringliteral">&quot;New configuration accepted on trajectory %i.\n&quot;</span>, itraj);</div>
<div class="line"><span class="lineno">  569</span>         <span class="comment">//Original FORTRAN Comment:</span></div>
<div class="line"><span class="lineno">  570</span>         <span class="comment">//JIS 20100525: write config here to preempt troubles during measurement!</span></div>
<div class="line"><span class="lineno">  571</span>         <span class="comment">//JIS 20100525: remove when all is ok....</span></div>
<div class="line"><span class="lineno">  572</span>         memcpy(u[0],ut[0],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  573</span>         memcpy(u[1],ut[1],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  574</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  575</span>         Transpose_z(u[0],<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>,<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>);</div>
<div class="line"><span class="lineno">  576</span>         Transpose_z(u[1],<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>,<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>);</div>
<div class="line"><span class="lineno">  577</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  578</span>         naccp++;</div>
<div class="line"><span class="lineno">  579</span>         <span class="comment">//Divide by gvol since we&#39;ve summed over all lattice sites</span></div>
<div class="line"><span class="lineno">  580</span>         action=S1/<a class="code hl_define" href="sizes_8h.html#aae3965888b92ccefd0fa4d96da415f65">gvol</a>;</div>
<div class="line"><span class="lineno">  581</span>         acc=<span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  582</span>      }</div>
<div class="line"><span class="lineno">  583</span>      <span class="keywordflow">else</span>{</div>
<div class="line"><span class="lineno">  584</span>         <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>)</div>
<div class="line"><span class="lineno">  585</span>            printf(<span class="stringliteral">&quot;New configuration rejected on trajectory %i.\n&quot;</span>, itraj);</div>
<div class="line"><span class="lineno">  586</span>         acc=<span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  587</span>      }</div>
<div class="line"><span class="lineno">  588</span>      actiona+=action; </div>
<div class="line"><span class="lineno">  589</span>      <span class="keywordtype">double</span> vel2=0.0;</div>
<div class="line"><span class="lineno">  590</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  591</span>      cublasDnrm2(cublas_handle,<a class="code hl_define" href="sizes_8h.html#a1f2e85d0eeb03e194221160b0acadd81">kmom</a>, pp, 1,&amp;vel2);</div>
<div class="line"><span class="lineno">  592</span>      vel2*=vel2;</div>
<div class="line"><span class="lineno">  593</span><span class="preprocessor">#elif defined USE_BLAS</span></div>
<div class="line"><span class="lineno">  594</span>      vel2 = cblas_dnrm2(<a class="code hl_define" href="sizes_8h.html#a1f2e85d0eeb03e194221160b0acadd81">kmom</a>, pp, 1);</div>
<div class="line"><span class="lineno">  595</span>      vel2*=vel2;</div>
<div class="line"><span class="lineno">  596</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  597</span><span class="preprocessor">#pragma unroll</span></div>
<div class="line"><span class="lineno">  598</span>      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code hl_define" href="sizes_8h.html#a1f2e85d0eeb03e194221160b0acadd81">kmom</a>; i++)</div>
<div class="line"><span class="lineno">  599</span>         vel2+=pp[i]*pp[i];</div>
<div class="line"><span class="lineno">  600</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  601</span><span class="preprocessor">#if(nproc&gt;1)</span></div>
<div class="line"><span class="lineno">  602</span>      <a class="code hl_function" href="par__mpi_8h.html#aecfe9840e5f8dfd693b813b750d81a0c">Par_dsum</a>(&amp;vel2);</div>
<div class="line"><span class="lineno">  603</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  604</span>      vel2a+=vel2/(<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a55cdab879029c36c07fbd9e7e9b109c9">nadj</a>*<a class="code hl_define" href="sizes_8h.html#aae3965888b92ccefd0fa4d96da415f65">gvol</a>);</div>
<div class="line"><span class="lineno">  605</span> </div>
<div class="line"><span class="lineno">  606</span>      <span class="keywordflow">if</span>(itraj%iprint==0){</div>
<div class="line"><span class="lineno">  607</span>         <span class="comment">//If rejected, copy the previously accepted field in for measurements</span></div>
<div class="line"><span class="lineno">  608</span>         <span class="keywordflow">if</span>(!acc){</div>
<div class="line"><span class="lineno">  609</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  610</span>            cudaMemcpyAsync(ut[0], u[0], <a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>),cudaMemcpyDefault,streams[0]);</div>
<div class="line"><span class="lineno">  611</span>            cudaMemcpyAsync(ut[1], u[1], <a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>),cudaMemcpyDefault,streams[1]);</div>
<div class="line"><span class="lineno">  612</span>            cudaDeviceSynchronise();</div>
<div class="line"><span class="lineno">  613</span>            Transpose_z(ut[0],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>,<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>);</div>
<div class="line"><span class="lineno">  614</span>            Transpose_z(ut[1],<a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>,<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>);</div>
<div class="line"><span class="lineno">  615</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  616</span>            memcpy(ut[0], u[0], <a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  617</span>            memcpy(ut[1], u[1], <a class="code hl_define" href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a>*<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>*<span class="keyword">sizeof</span>(<a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a>));</div>
<div class="line"><span class="lineno">  618</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  619</span>            <a class="code hl_function" href="par__mpi_8h.html#abf4867774abbc820eb4aaaeabbee31f4">Trial_Exchange</a>(ut,ut_f);</div>
<div class="line"><span class="lineno">  620</span>         }</div>
<div class="line"><span class="lineno">  621</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  622</span>         <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>)</div>
<div class="line"><span class="lineno">  623</span>            printf(<span class="stringliteral">&quot;Starting measurements\n&quot;</span>);</div>
<div class="line"><span class="lineno">  624</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  625</span>         <span class="keywordtype">int</span> itercg=0;</div>
<div class="line"><span class="lineno">  626</span>         <span class="keywordtype">double</span> endenf, denf;</div>
<div class="line"><span class="lineno">  627</span>         <a class="code hl_define" href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a> qbqb;</div>
<div class="line"><span class="lineno">  628</span>         <span class="comment">//Stop gap for measurement failure on Kay;</span></div>
<div class="line"><span class="lineno">  629</span>         <span class="comment">//If the Congrad in Measure fails, don&#39;t measure the Diquark or PBP-Density observables for</span></div>
<div class="line"><span class="lineno">  630</span>         <span class="comment">//that trajectory</span></div>
<div class="line"><span class="lineno">  631</span>         <span class="keywordtype">int</span> measure_check=0;</div>
<div class="line"><span class="lineno">  632</span>         measure_check = <a class="code hl_function" href="su2hmc_8h.html#a4f76ed3be4902e11205760b4222665c8">Measure</a>(&amp;pbp,&amp;endenf,&amp;denf,&amp;qq,&amp;qbqb,<a class="code hl_define" href="sizes_8h.html#aadcdbf20ae08c6005b8972433a4e3aaa">respbp</a>,&amp;itercg,ut,ut_f,iu,<span class="keywordtype">id</span>,\</div>
<div class="line"><span class="lineno">  633</span>               gamval,gamval_f,gamin,dk,dk_f,jqq,akappa,Phi,R1);</div>
<div class="line"><span class="lineno">  634</span><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><span class="lineno">  635</span>         <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>)</div>
<div class="line"><span class="lineno">  636</span>            printf(<span class="stringliteral">&quot;Finished measurements\n&quot;</span>);</div>
<div class="line"><span class="lineno">  637</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  638</span>         pbpa+=pbp; endenfa+=endenf; denfa+=denf; ipbp++;</div>
<div class="line"><span class="lineno">  639</span>         <a class="code hl_function" href="su2hmc_8h.html#a2c38affebb6d51c6132aedeb69e2c46e">Average_Plaquette</a>(&amp;hg,&amp;avplaqs,&amp;avplaqt,ut_f,iu,beta);</div>
<div class="line"><span class="lineno">  640</span>         poly = <a class="code hl_function" href="su2hmc_8h.html#a247c28a831d22009693ea8465b3f99cd">Polyakov</a>(ut_f);</div>
<div class="line"><span class="lineno">  641</span>         <span class="comment">//We have four output files, so may as well get the other ranks to help out</span></div>
<div class="line"><span class="lineno">  642</span>         <span class="comment">//and abuse scoping rules while we&#39;re at it.</span></div>
<div class="line"><span class="lineno">  643</span>         <span class="comment">//Can use either OpenMP or MPI to do this</span></div>
<div class="line"><span class="lineno">  644</span><span class="preprocessor">#if (nproc&gt;=4)</span></div>
<div class="line"><span class="lineno">  645</span>         <span class="keywordflow">switch</span>(<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>)</div>
<div class="line"><span class="lineno">  646</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  647</span>            <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>)</div>
<div class="line"><span class="lineno">  648</span><span class="preprocessor">#pragma omp parallel for</span></div>
<div class="line"><span class="lineno">  649</span>               <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;4; i++)</div>
<div class="line"><span class="lineno">  650</span>                  <span class="keywordflow">switch</span>(i)</div>
<div class="line"><span class="lineno">  651</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  652</span>                  {</div>
<div class="line"><span class="lineno">  653</span>                     <span class="keywordflow">case</span>(0): </div>
<div class="line"><span class="lineno">  654</span>                        <span class="comment">//Output code... Some files weren&#39;t opened in the main loop of the FORTRAN code </span></div>
<div class="line"><span class="lineno">  655</span>                        <span class="comment">//That will need to be looked into for the C version</span></div>
<div class="line"><span class="lineno">  656</span>                        <span class="comment">//It would explain the weird names like fort.1X that looked like they were somehow</span></div>
<div class="line"><span class="lineno">  657</span>                        <span class="comment">//FORTRAN related...</span></div>
<div class="line"><span class="lineno">  658</span>                        fprintf(output, <span class="stringliteral">&quot;Measure (CG) %i Update (CG) %.3f Hamiltonian (CG) %.3f\n&quot;</span>, itercg, ancg, ancgh);</div>
<div class="line"><span class="lineno">  659</span>                        fflush(output);</div>
<div class="line"><span class="lineno">  660</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  661</span>                     <span class="keywordflow">case</span>(1):</div>
<div class="line"><span class="lineno">  662</span>                        {</div>
<div class="line"><span class="lineno">  663</span>                           FILE *fortout;</div>
<div class="line"><span class="lineno">  664</span>                           <span class="keywordtype">char</span> fortname[<a class="code hl_define" href="sizes_8h.html#ab5757303b45686827c94c395603817af">FILELEN</a>] = <span class="stringliteral">&quot;fermi.&quot;</span>;</div>
<div class="line"><span class="lineno">  665</span>                           strcat(fortname,suffix);</div>
<div class="line"><span class="lineno">  666</span>                           <span class="keyword">const</span> <span class="keywordtype">char</span> *fortop= (itraj==1) ? <span class="stringliteral">&quot;w&quot;</span> : <span class="stringliteral">&quot;a&quot;</span>;</div>
<div class="line"><span class="lineno">  667</span>                           <span class="keywordflow">if</span>(!(fortout=fopen(fortname, fortop) )){</div>
<div class="line"><span class="lineno">  668</span>                              fprintf(stderr, <span class="stringliteral">&quot;Error %i in %s: Failed to open file %s for %s.\nExiting\n\n&quot;</span>,\</div>
<div class="line"><span class="lineno">  669</span>                                    OPENERROR, funcname, fortname, fortop);</div>
<div class="line"><span class="lineno">  670</span><span class="preprocessor">#if(nproc&gt;1)</span></div>
<div class="line"><span class="lineno">  671</span>                              MPI_Abort(comm,OPENERROR);</div>
<div class="line"><span class="lineno">  672</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  673</span>                              exit(OPENERROR);</div>
<div class="line"><span class="lineno">  674</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  675</span>                           }</div>
<div class="line"><span class="lineno">  676</span>                           <span class="keywordflow">if</span>(itraj==1)</div>
<div class="line"><span class="lineno">  677</span>                              fprintf(fortout, <span class="stringliteral">&quot;pbp\tendenf\tdenf\n&quot;</span>);</div>
<div class="line"><span class="lineno">  678</span>                           <span class="keywordflow">if</span>(measure_check)</div>
<div class="line"><span class="lineno">  679</span>                              fprintf(fortout, <span class="stringliteral">&quot;%e\t%e\t%e\n&quot;</span>, NAN, NAN, NAN);</div>
<div class="line"><span class="lineno">  680</span>                           <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  681</span>                              fprintf(fortout, <span class="stringliteral">&quot;%e\t%e\t%e\n&quot;</span>, pbp, endenf, denf);</div>
<div class="line"><span class="lineno">  682</span>                           fclose(fortout);</div>
<div class="line"><span class="lineno">  683</span>                           <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  684</span>                        }</div>
<div class="line"><span class="lineno">  685</span>                     <span class="keywordflow">case</span>(2):</div>
<div class="line"><span class="lineno">  686</span>                        <span class="comment">//The original code implicitly created these files with the name</span></div>
<div class="line"><span class="lineno">  687</span>                        <span class="comment">//fort.XX where XX is the file label</span></div>
<div class="line"><span class="lineno">  688</span>                        <span class="comment">//from FORTRAN. This was fort.12</span></div>
<div class="line"><span class="lineno">  689</span>                        {</div>
<div class="line"><span class="lineno">  690</span>                           FILE *fortout;</div>
<div class="line"><span class="lineno">  691</span>                           <span class="keywordtype">char</span> fortname[<a class="code hl_define" href="sizes_8h.html#ab5757303b45686827c94c395603817af">FILELEN</a>] = <span class="stringliteral">&quot;bose.&quot;</span>; </div>
<div class="line"><span class="lineno">  692</span>                           strcat(fortname,suffix);</div>
<div class="line"><span class="lineno">  693</span>                           <span class="keyword">const</span> <span class="keywordtype">char</span> *fortop= (itraj==1) ? <span class="stringliteral">&quot;w&quot;</span> : <span class="stringliteral">&quot;a&quot;</span>;</div>
<div class="line"><span class="lineno">  694</span>                           <span class="keywordflow">if</span>(!(fortout=fopen(fortname, fortop) )){</div>
<div class="line"><span class="lineno">  695</span>                              fprintf(stderr, <span class="stringliteral">&quot;Error %i in %s: Failed to open file %s for %s.\nExiting\n\n&quot;</span>,\</div>
<div class="line"><span class="lineno">  696</span>                                    OPENERROR, funcname, fortname, fortop);</div>
<div class="line"><span class="lineno">  697</span>                           }</div>
<div class="line"><span class="lineno">  698</span>                           <span class="keywordflow">if</span>(itraj==1)</div>
<div class="line"><span class="lineno">  699</span>                              fprintf(fortout, <span class="stringliteral">&quot;avplaqs\tavplaqt\tpoly\n&quot;</span>);</div>
<div class="line"><span class="lineno">  700</span>                           fprintf(fortout, <span class="stringliteral">&quot;%e\t%e\t%e\n&quot;</span>, avplaqs, avplaqt, poly);</div>
<div class="line"><span class="lineno">  701</span>                           fclose(fortout);</div>
<div class="line"><span class="lineno">  702</span>                           <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  703</span>                        }</div>
<div class="line"><span class="lineno">  704</span>                     <span class="keywordflow">case</span>(3):</div>
<div class="line"><span class="lineno">  705</span>                        {</div>
<div class="line"><span class="lineno">  706</span>                           FILE *fortout;</div>
<div class="line"><span class="lineno">  707</span>                           <span class="keywordtype">char</span> fortname[<a class="code hl_define" href="sizes_8h.html#ab5757303b45686827c94c395603817af">FILELEN</a>] = <span class="stringliteral">&quot;diq.&quot;</span>;</div>
<div class="line"><span class="lineno">  708</span>                           strcat(fortname,suffix);</div>
<div class="line"><span class="lineno">  709</span>                           <span class="keyword">const</span> <span class="keywordtype">char</span> *fortop= (itraj==1) ? <span class="stringliteral">&quot;w&quot;</span> : <span class="stringliteral">&quot;a&quot;</span>;</div>
<div class="line"><span class="lineno">  710</span>                           <span class="keywordflow">if</span>(!(fortout=fopen(fortname, fortop) )){</div>
<div class="line"><span class="lineno">  711</span>                              fprintf(stderr, <span class="stringliteral">&quot;Error %i in %s: Failed to open file %s for %s.\nExiting\n\n&quot;</span>,\</div>
<div class="line"><span class="lineno">  712</span>                                    OPENERROR, funcname, fortname, fortop);</div>
<div class="line"><span class="lineno">  713</span><span class="preprocessor">#if(nproc&gt;1)</span></div>
<div class="line"><span class="lineno">  714</span>                              MPI_Abort(comm,OPENERROR);</div>
<div class="line"><span class="lineno">  715</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  716</span>                              exit(OPENERROR);</div>
<div class="line"><span class="lineno">  717</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  718</span>                           }</div>
<div class="line"><span class="lineno">  719</span>                           <span class="keywordflow">if</span>(itraj==1)</div>
<div class="line"><span class="lineno">  720</span>                              fprintf(fortout, <span class="stringliteral">&quot;Re(qq)\n&quot;</span>);</div>
<div class="line"><span class="lineno">  721</span>                           <span class="keywordflow">if</span>(measure_check)</div>
<div class="line"><span class="lineno">  722</span>                              fprintf(fortout, <span class="stringliteral">&quot;%e\n&quot;</span>, NAN);</div>
<div class="line"><span class="lineno">  723</span>                           <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  724</span>                              fprintf(fortout, <span class="stringliteral">&quot;%e\n&quot;</span>, creal(qq));</div>
<div class="line"><span class="lineno">  725</span>                           fclose(fortout);</div>
<div class="line"><span class="lineno">  726</span>                           <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  727</span>                        }</div>
<div class="line"><span class="lineno">  728</span>                     <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  729</span>                  }</div>
<div class="line"><span class="lineno">  730</span>      }</div>
<div class="line"><span class="lineno">  731</span>      <span class="keywordflow">if</span>(itraj%icheck==0){</div>
<div class="line"><span class="lineno">  732</span>         <a class="code hl_function" href="par__mpi_8h.html#a1539b6a5eca3dfc3934cfb37d850ad9d">Par_swrite</a>(itraj,icheck,beta,fmu,akappa,ajq,u[0],u[1]);</div>
<div class="line"><span class="lineno">  733</span>      }</div>
<div class="line"><span class="lineno">  734</span>      <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>)</div>
<div class="line"><span class="lineno">  735</span>         fflush(output);</div>
<div class="line"><span class="lineno">  736</span>   }</div>
<div class="line"><span class="lineno">  737</span><span class="preprocessor">#if (defined SA3AT)</span></div>
<div class="line"><span class="lineno">  738</span>   <span class="keywordtype">double</span> elapsed = 0;</div>
<div class="line"><span class="lineno">  739</span>   <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>){</div>
<div class="line"><span class="lineno">  740</span><span class="preprocessor">#if(nproc&gt;1)</span></div>
<div class="line"><span class="lineno">  741</span>      elapsed = MPI_Wtime()-start_time;</div>
<div class="line"><span class="lineno">  742</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  743</span>      elapsed = omp_get_wtime()-start_time;</div>
<div class="line"><span class="lineno">  744</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  745</span>   }</div>
<div class="line"><span class="lineno">  746</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  747</span>   <span class="comment">//End of main loop</span></div>
<div class="line"><span class="lineno">  748</span>   <span class="comment">//Free arrays</span></div>
<div class="line"><span class="lineno">  749</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  750</span>   <span class="comment">//Make a routine that does this for us</span></div>
<div class="line"><span class="lineno">  751</span>   cudaFree(dk[0]); cudaFree(dk[1]); cudaFree(R1); cudaFree(dSdpi); cudaFree(pp);</div>
<div class="line"><span class="lineno">  752</span>   cudaFree(Phi); cudaFree(ut[0]); cudaFree(ut[1]);</div>
<div class="line"><span class="lineno">  753</span>   cudaFree(X0); cudaFree(X1); cudaFree(u[0]); cudaFree(u[1]);</div>
<div class="line"><span class="lineno">  754</span>   cudaFree(<span class="keywordtype">id</span>); cudaFree(iu); </div>
<div class="line"><span class="lineno">  755</span>   cudaFree(dk_f[0]); cudaFree(dk_f[1]); cudaFree(ut_f[0]); cudaFree(ut_f[1]);</div>
<div class="line"><span class="lineno">  756</span>   cudaFree(gamin); cudaFree(gamval); cudaFree(gamval_f);</div>
<div class="line"><span class="lineno">  757</span>   cublasDestroy(cublas_handle);</div>
<div class="line"><span class="lineno">  758</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  759</span>   free(dk[0]); free(dk[1]); free(R1); free(dSdpi); free(pp);</div>
<div class="line"><span class="lineno">  760</span>   free(Phi); free(ut[0]); free(ut[1]);</div>
<div class="line"><span class="lineno">  761</span>   free(X0); free(X1); free(u[0]); free(u[1]);</div>
<div class="line"><span class="lineno">  762</span>   free(<span class="keywordtype">id</span>); free(iu);</div>
<div class="line"><span class="lineno">  763</span>   free(dk_f[0]); free(dk_f[1]); free(ut_f[0]); free(ut_f[1]);</div>
<div class="line"><span class="lineno">  764</span>   free(gamin); free(gamval); free(gamval_f);</div>
<div class="line"><span class="lineno">  765</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  766</span>   free(<a class="code hl_variable" href="coord_8h.html#abbd8034942e42e0aa8c94a756d616e2d">hd</a>); free(<a class="code hl_variable" href="coord_8h.html#ac76e1a2ca235d93f69e04f74aad64e03">hu</a>);free(<a class="code hl_variable" href="coord_8h.html#a8b7865e3a1810f252a92cbfb21722978">h1u</a>); free(<a class="code hl_variable" href="coord_8h.html#aaff395e4c444dba59490867fbe712ace">h1d</a>); free(<a class="code hl_variable" href="coord_8h.html#ab5787e50b58e36ac57f506fe7e98d132">halosize</a>); free(<a class="code hl_variable" href="par__mpi_8h.html#af1203065e4085a62dc779cad1b202662">pcoord</a>);</div>
<div class="line"><span class="lineno">  767</span><span class="preprocessor">#ifdef __RANLUX__</span></div>
<div class="line"><span class="lineno">  768</span>   gsl_rng_free(ranlux_instd);</div>
<div class="line"><span class="lineno">  769</span><span class="preprocessor">#elif (defined __INTEL_MKL__ &amp;&amp;!defined USE_RAN2)</span></div>
<div class="line"><span class="lineno">  770</span>   vslDeleteStream(&amp;stream);</div>
<div class="line"><span class="lineno">  771</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  772</span><span class="preprocessor">#if (defined SA3AT)</span></div>
<div class="line"><span class="lineno">  773</span>   <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>){</div>
<div class="line"><span class="lineno">  774</span>      FILE *sa3at = fopen(<span class="stringliteral">&quot;Bench_times.csv&quot;</span>, <span class="stringliteral">&quot;a&quot;</span>);</div>
<div class="line"><span class="lineno">  775</span><span class="preprocessor">#ifdef __NVCC__</span></div>
<div class="line"><span class="lineno">  776</span>      <span class="keywordtype">char</span> *version[256];</div>
<div class="line"><span class="lineno">  777</span>      <span class="keywordtype">int</span> cuversion; cudaRuntimeGetVersion(&amp;cuversion);</div>
<div class="line"><span class="lineno">  778</span>      sprintf(version,<span class="stringliteral">&quot;CUDA %d\tBlock: (%d,%d,%d)\tGrid: (%d,%d,%d)\n%s\n&quot;</span>,cuversion,\</div>
<div class="line"><span class="lineno">  779</span>            dimBlock.x,dimBlock.y,dimBlock.z,dimGrid.x,dimGrid.y,dimGrid.z,__VERSION__);</div>
<div class="line"><span class="lineno">  780</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  781</span>      <span class="keywordtype">char</span> *version=__VERSION__;</div>
<div class="line"><span class="lineno">  782</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  783</span>      fprintf(sa3at, <span class="stringliteral">&quot;%s\nβ%0.3f κ:%0.4f μ:%0.4f j:%0.3f s:%i t:%i kvol:%ld\n&quot;</span></div>
<div class="line"><span class="lineno">  784</span>            <span class="stringliteral">&quot;npx:%i npt:%i nthread:%i ncore:%i time:%f traj_time:%f\n\n&quot;</span>,\</div>
<div class="line"><span class="lineno">  785</span>            version,beta,akappa,fmu,ajq,<a class="code hl_define" href="sizes_8h.html#a20074569426d76a5518d4fc993f39687">nx</a>,<a class="code hl_define" href="sizes_8h.html#a0a16c4ba7a97b8fbe2b7cafe00dc7896">nt</a>,<a class="code hl_define" href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a>,<a class="code hl_define" href="sizes_8h.html#a486c992648d0066d587ac516f62a1acd">npx</a>,<a class="code hl_define" href="sizes_8h.html#ad19c525e8039fa0d7ce7703442872c88">npt</a>,<a class="code hl_define" href="sizes_8h.html#a8705b462037cbb37aaa5cc1660c33062">nthreads</a>,<a class="code hl_define" href="sizes_8h.html#a486c992648d0066d587ac516f62a1acd">npx</a>*<a class="code hl_define" href="sizes_8h.html#ac97223a0b104faae1e25454b2ba2f7a1">npy</a>*<a class="code hl_define" href="sizes_8h.html#a834b9d3c7db59de0d906f00f719ab2f4">npz</a>*<a class="code hl_define" href="sizes_8h.html#ad19c525e8039fa0d7ce7703442872c88">npt</a>*<a class="code hl_define" href="sizes_8h.html#a8705b462037cbb37aaa5cc1660c33062">nthreads</a>,elapsed,elapsed/ntraj);</div>
<div class="line"><span class="lineno">  786</span>      fclose(sa3at);</div>
<div class="line"><span class="lineno">  787</span>   }</div>
<div class="line"><span class="lineno">  788</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  789</span>   <span class="comment">//Get averages for final output</span></div>
<div class="line"><span class="lineno">  790</span>   actiona/=ntraj; vel2a/=ntraj; pbpa/=ipbp; endenfa/=ipbp; denfa/=ipbp;</div>
<div class="line"><span class="lineno">  791</span>   totancg/=ntraj; totancgh/=ntraj; </div>
<div class="line"><span class="lineno">  792</span>   e_dH/=ntraj; e_dH_e=sqrt((e_dH_e/ntraj-e_dH*e_dH)/(ntraj-1));</div>
<div class="line"><span class="lineno">  793</span>   yav/=ntraj; yyav=sqrt((yyav/ntraj - yav*yav)/(ntraj-1));</div>
<div class="line"><span class="lineno">  794</span>   <span class="keywordtype">float</span> traj_cost=totancg/dt;</div>
<div class="line"><span class="lineno">  795</span>   <span class="keywordtype">double</span> atraj=dt*itot/ntraj;</div>
<div class="line"><span class="lineno">  796</span> </div>
<div class="line"><span class="lineno">  797</span>   <span class="keywordflow">if</span>(!<a class="code hl_variable" href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>){</div>
<div class="line"><span class="lineno">  798</span>      fprintf(output, <span class="stringliteral">&quot;Averages for the last %i trajectories\n&quot;</span>\</div>
<div class="line"><span class="lineno">  799</span>            <span class="stringliteral">&quot;Number of acceptances: %i\tAverage Trajectory Length = %e\n&quot;</span>\</div>
<div class="line"><span class="lineno">  800</span>            <span class="stringliteral">&quot;&lt;dH&gt;=%e+/-%e\t&lt;exp(dH)&gt;=%e+/-%e\tTrajectory cost=N_cg/dt =%e\n&quot;</span>\</div>
<div class="line"><span class="lineno">  801</span>            <span class="stringliteral">&quot;Average number of congrad iter guidance: %.3f acceptance %.3f\n&quot;</span>\</div>
<div class="line"><span class="lineno">  802</span>            <span class="stringliteral">&quot;psibarpsi = %e\n&quot;</span>\</div>
<div class="line"><span class="lineno">  803</span>            <span class="stringliteral">&quot;Mean Square Velocity = %e\tAction Per Site = %e\n&quot;</span>\</div>
<div class="line"><span class="lineno">  804</span>            <span class="stringliteral">&quot;Energy Density = %e\tNumber Density %e\n\n\n&quot;</span>,\</div>
<div class="line"><span class="lineno">  805</span>            ntraj, naccp, atraj, e_dH,e_dH_e, yav, yyav, traj_cost, totancg, totancgh, pbpa, vel2a, actiona, endenfa, denfa);</div>
<div class="line"><span class="lineno">  806</span>      fclose(output);</div>
<div class="line"><span class="lineno">  807</span>   }</div>
<div class="line"><span class="lineno">  808</span><span class="preprocessor">#if(nproc&gt;1)</span></div>
<div class="line"><span class="lineno">  809</span>   <span class="comment">//Ensure writing is done before finalising just in case finalise segfaults and crashes the other ranks mid-write</span></div>
<div class="line"><span class="lineno">  810</span>   MPI_Barrier(comm);</div>
<div class="line"><span class="lineno">  811</span>   <a class="code hl_define" href="par__mpi_8h.html#abf7c8266b66e17d7c820f4213023b135">MPI_Finalise</a>();</div>
<div class="line"><span class="lineno">  812</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  813</span>   fflush(stdout);</div>
<div class="line"><span class="lineno">  814</span>   <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  815</span>}</div>
<div class="ttc" id="acoord_8h_html_a8b7865e3a1810f252a92cbfb21722978"><div class="ttname"><a href="coord_8h.html#a8b7865e3a1810f252a92cbfb21722978">h1u</a></div><div class="ttdeci">unsigned int * h1u</div><div class="ttdoc">Up halo starting element.</div><div class="ttdef"><b>Definition</b> <a href="coord_8c_source.html#l00015">coord.c:15</a></div></div>
<div class="ttc" id="acoord_8h_html_aaff395e4c444dba59490867fbe712ace"><div class="ttname"><a href="coord_8h.html#aaff395e4c444dba59490867fbe712ace">h1d</a></div><div class="ttdeci">unsigned int * h1d</div><div class="ttdoc">Down halo starting element.</div><div class="ttdef"><b>Definition</b> <a href="coord_8c_source.html#l00015">coord.c:15</a></div></div>
<div class="ttc" id="acoord_8h_html_ab5787e50b58e36ac57f506fe7e98d132"><div class="ttname"><a href="coord_8h.html#ab5787e50b58e36ac57f506fe7e98d132">halosize</a></div><div class="ttdeci">unsigned int * halosize</div><div class="ttdoc">Array containing the size of the halo in each direction.</div><div class="ttdef"><b>Definition</b> <a href="coord_8c_source.html#l00015">coord.c:15</a></div></div>
<div class="ttc" id="acoord_8h_html_abbd8034942e42e0aa8c94a756d616e2d"><div class="ttname"><a href="coord_8h.html#abbd8034942e42e0aa8c94a756d616e2d">hd</a></div><div class="ttdeci">unsigned int * hd</div><div class="ttdoc">Down halo indices.</div><div class="ttdef"><b>Definition</b> <a href="coord_8c_source.html#l00015">coord.c:15</a></div></div>
<div class="ttc" id="acoord_8h_html_ac76e1a2ca235d93f69e04f74aad64e03"><div class="ttname"><a href="coord_8h.html#ac76e1a2ca235d93f69e04f74aad64e03">hu</a></div><div class="ttdeci">unsigned int * hu</div><div class="ttdoc">Up halo indices.</div><div class="ttdef"><b>Definition</b> <a href="coord_8c_source.html#l00015">coord.c:15</a></div></div>
<div class="ttc" id="aintegrate_8h_html_a33907d89c4a0709fcf809773de68c3a2"><div class="ttname"><a href="integrate_8h.html#a33907d89c4a0709fcf809773de68c3a2">OMF2</a></div><div class="ttdeci">int OMF2(Complex *ut[2], Complex_f *ut_f[2], Complex *X0, Complex *X1, Complex *Phi, double *dk[2], float *dk_f[2], double *dSdpi, double *pp, int *iu, int *id, Complex *gamval, Complex_f *gamval_f, int *gamin, Complex jqq, float beta, float akappa, int stepl, float dt, double *ancg, int *itot, float proby)</div><div class="ttdoc">OMF second order five step integrator.</div><div class="ttdef"><b>Definition</b> <a href="integrate_8c_source.html#l00116">integrate.c:116</a></div></div>
<div class="ttc" id="aintegrate_8h_html_a4d7f64e9f3e98a2953d707f18742d110"><div class="ttname"><a href="integrate_8h.html#a4d7f64e9f3e98a2953d707f18742d110">Leapfrog</a></div><div class="ttdeci">int Leapfrog(Complex *ut[2], Complex_f *ut_f[2], Complex *X0, Complex *X1, Complex *Phi, double *dk[2], float *dk_f[2], double *dSdpi, double *pp, int *iu, int *id, Complex *gamval, Complex_f *gamval_f, int *gamin, Complex jqq, float beta, float akappa, int stepl, float dt, double *ancg, int *itot, float proby)</div><div class="ttdoc">Leapfrog integrator. Each trajectory step takes the form of p-&gt;p+dt/2,u-&gt;u+dt,p-&gt;p+dt/2 In practice t...</div><div class="ttdef"><b>Definition</b> <a href="integrate_8c_source.html#l00065">integrate.c:65</a></div></div>
<div class="ttc" id="aintegrate_8h_html_a4e6abc4e61c0131df30fb683569e5d00"><div class="ttname"><a href="integrate_8h.html#a4e6abc4e61c0131df30fb683569e5d00">OMF4</a></div><div class="ttdeci">int OMF4(Complex *ut[2], Complex_f *ut_f[2], Complex *X0, Complex *X1, Complex *Phi, double *dk[2], float *dk_f[2], double *dSdpi, double *pp, int *iu, int *id, Complex *gamval, Complex_f *gamval_f, int *gamin, Complex jqq, float beta, float akappa, int stepl, float dt, double *ancg, int *itot, float proby)</div><div class="ttdoc">OMF fourth order eleven step integrator.</div><div class="ttdef"><b>Definition</b> <a href="integrate_8c_source.html#l00194">integrate.c:194</a></div></div>
<div class="ttc" id="amatrices_8h_html_aeb1a49b42df431462e62cf11270a7131"><div class="ttname"><a href="matrices_8h.html#aeb1a49b42df431462e62cf11270a7131">Dslashd_f</a></div><div class="ttdeci">int Dslashd_f(Complex_f *phi, Complex_f *r, Complex_f *u11t, Complex_f *u12t, unsigned int *iu, unsigned int *id, Complex_f *gamval, int *gamin, float *dk[2], Complex_f jqq, float akappa)</div><div class="ttdoc">Evaluates  in single precision.</div><div class="ttdef"><b>Definition</b> <a href="matrices_8c_source.html#l00585">matrices.c:585</a></div></div>
<div class="ttc" id="apar__mpi_8h_html_a1539b6a5eca3dfc3934cfb37d850ad9d"><div class="ttname"><a href="par__mpi_8h.html#a1539b6a5eca3dfc3934cfb37d850ad9d">Par_swrite</a></div><div class="ttdeci">int Par_swrite(const int itraj, const int icheck, const float beta, const float fmu, const float akappa, const Complex_f ajq, Complex *u11, Complex *u12)</div><div class="ttdoc">Copies u11 and u12 into arrays without halos which then get written to output.</div><div class="ttdef"><b>Definition</b> <a href="par__mpi_8c_source.html#l00341">par_mpi.c:341</a></div></div>
<div class="ttc" id="apar__mpi_8h_html_a31e5f4f36c6e583903e8dd06dbf76fc6"><div class="ttname"><a href="par__mpi_8h.html#a31e5f4f36c6e583903e8dd06dbf76fc6">Par_fcopy</a></div><div class="ttdeci">int Par_fcopy(float *fval)</div><div class="ttdoc">Broadcasts a float to the other processes.</div></div>
<div class="ttc" id="apar__mpi_8h_html_a439227feff9d7f55384e8780cfc2eb82"><div class="ttname"><a href="par__mpi_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a></div><div class="ttdeci">int size</div><div class="ttdoc">The number of MPI ranks in total.</div><div class="ttdef"><b>Definition</b> <a href="par__mpi_8c_source.html#l00022">par_mpi.c:22</a></div></div>
<div class="ttc" id="apar__mpi_8h_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="par__mpi_8h.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a></div><div class="ttdeci">int rank</div><div class="ttdoc">The MPI rank.</div><div class="ttdef"><b>Definition</b> <a href="par__mpi_8c_source.html#l00022">par_mpi.c:22</a></div></div>
<div class="ttc" id="apar__mpi_8h_html_a6f500abd59b184cac1dbcf47b04c185a"><div class="ttname"><a href="par__mpi_8h.html#a6f500abd59b184cac1dbcf47b04c185a">Par_begin</a></div><div class="ttdeci">int Par_begin(int argc, char *argv[])</div><div class="ttdoc">Initialises the MPI configuration.</div><div class="ttdef"><b>Definition</b> <a href="par__mpi_8c_source.html#l00025">par_mpi.c:25</a></div></div>
<div class="ttc" id="apar__mpi_8h_html_a82049c8a7fcf726d3b222e4fedf6f674"><div class="ttname"><a href="par__mpi_8h.html#a82049c8a7fcf726d3b222e4fedf6f674">Par_icopy</a></div><div class="ttdeci">int Par_icopy(int *ival)</div><div class="ttdoc">Broadcasts an integer to the other processes.</div></div>
<div class="ttc" id="apar__mpi_8h_html_abf4867774abbc820eb4aaaeabbee31f4"><div class="ttname"><a href="par__mpi_8h.html#abf4867774abbc820eb4aaaeabbee31f4">Trial_Exchange</a></div><div class="ttdeci">int Trial_Exchange(Complex *ut[2], Complex_f *ut_f[2])</div><div class="ttdoc">Exchanges the trial fields.</div><div class="ttdef"><b>Definition</b> <a href="par__mpi_8c_source.html#l01178">par_mpi.c:1178</a></div></div>
<div class="ttc" id="apar__mpi_8h_html_abf7c8266b66e17d7c820f4213023b135"><div class="ttname"><a href="par__mpi_8h.html#abf7c8266b66e17d7c820f4213023b135">MPI_Finalise</a></div><div class="ttdeci">#define MPI_Finalise()</div><div class="ttdoc">Avoid any accidents with US/UK spelling.</div><div class="ttdef"><b>Definition</b> <a href="par__mpi_8h_source.html#l00030">par_mpi.h:30</a></div></div>
<div class="ttc" id="apar__mpi_8h_html_aecfe9840e5f8dfd693b813b750d81a0c"><div class="ttname"><a href="par__mpi_8h.html#aecfe9840e5f8dfd693b813b750d81a0c">Par_dsum</a></div><div class="ttdeci">int Par_dsum(double *dval)</div><div class="ttdoc">Performs a reduction on a double dval to get a sum which is then distributed to all ranks.</div></div>
<div class="ttc" id="apar__mpi_8h_html_af1203065e4085a62dc779cad1b202662"><div class="ttname"><a href="par__mpi_8h.html#af1203065e4085a62dc779cad1b202662">pcoord</a></div><div class="ttdeci">int * pcoord</div><div class="ttdoc">The processor grid.</div><div class="ttdef"><b>Definition</b> <a href="par__mpi_8c_source.html#l00019">par_mpi.c:19</a></div></div>
<div class="ttc" id="arandom_8c_html_ae71449b1cc6e6250b91f539153a7a0d3"><div class="ttname"><a href="random_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a></div><div class="ttdeci">#define M_PI</div><div class="ttdoc">if not defined elsewhere</div><div class="ttdef"><b>Definition</b> <a href="random_8c_source.html#l00041">random.c:41</a></div></div>
<div class="ttc" id="arandom_8h_html_a859e92fda23ce37dad2971362f72a50d"><div class="ttname"><a href="random_8h.html#a859e92fda23ce37dad2971362f72a50d">Gauss_c</a></div><div class="ttdeci">int Gauss_c(Complex_f *ps, unsigned int n, const Complex_f mu, const float sigma)</div><div class="ttdoc">Generates a vector of normally distributed random single precision complex numbers using the Box-Mull...</div><div class="ttdef"><b>Definition</b> <a href="random_8c_source.html#l00260">random.c:260</a></div></div>
<div class="ttc" id="arandom_8h_html_aaaabdcbfe66bb65cb57139509f6ea496"><div class="ttname"><a href="random_8h.html#aaaabdcbfe66bb65cb57139509f6ea496">Gauss_d</a></div><div class="ttdeci">int Gauss_d(double *ps, unsigned int n, const double mu, const double sigma)</div><div class="ttdoc">Generates a vector of normally distributed random double precision numbers using the Box-Muller Metho...</div><div class="ttdef"><b>Definition</b> <a href="random_8c_source.html#l00306">random.c:306</a></div></div>
<div class="ttc" id="arandom_8h_html_af30389dbea7d2b366abea7a923bb008d"><div class="ttname"><a href="random_8h.html#af30389dbea7d2b366abea7a923bb008d">Par_granf</a></div><div class="ttdeci">double Par_granf()</div><div class="ttdoc">Generates a random double which is then sent to the other ranks.</div><div class="ttdef"><b>Definition</b> <a href="random_8c_source.html#l00190">random.c:190</a></div></div>
<div class="ttc" id="arandom_8h_html_affb5f34f39f7103b999d198b18ffed8e"><div class="ttname"><a href="random_8h.html#affb5f34f39f7103b999d198b18ffed8e">seed</a></div><div class="ttdeci">long seed</div><div class="ttdoc">RAN2 seed.</div><div class="ttdef"><b>Definition</b> <a href="random_8c_source.html#l00027">random.c:27</a></div></div>
<div class="ttc" id="asizes_8h_html_a0235e95ffa2570e0d229e23f65855719"><div class="ttname"><a href="sizes_8h.html#a0235e95ffa2570e0d229e23f65855719">AVX</a></div><div class="ttdeci">#define AVX</div><div class="ttdoc">Alignment of arrays. 64 for AVX-512, 32 for AVX/AVX2. 16 for SSE. Since AVX is standard on modern x86...</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00268">sizes.h:268</a></div></div>
<div class="ttc" id="asizes_8h_html_a0845b4b004824f1fe3cd69db1672fa15"><div class="ttname"><a href="sizes_8h.html#a0845b4b004824f1fe3cd69db1672fa15">nc</a></div><div class="ttdeci">#define nc</div><div class="ttdoc">Colours.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00173">sizes.h:173</a></div></div>
<div class="ttc" id="asizes_8h_html_a093a588ccbffef2360dc858ed61389b1"><div class="ttname"><a href="sizes_8h.html#a093a588ccbffef2360dc858ed61389b1">rescgg</a></div><div class="ttdeci">#define rescgg</div><div class="ttdoc">Conjugate gradient residue for update.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00240">sizes.h:240</a></div></div>
<div class="ttc" id="asizes_8h_html_a0a16c4ba7a97b8fbe2b7cafe00dc7896"><div class="ttname"><a href="sizes_8h.html#a0a16c4ba7a97b8fbe2b7cafe00dc7896">nt</a></div><div class="ttdeci">#define nt</div><div class="ttdoc">Lattice temporal extent. This also corresponds to the inverse temperature.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00086">sizes.h:86</a></div></div>
<div class="ttc" id="asizes_8h_html_a1f2e85d0eeb03e194221160b0acadd81"><div class="ttname"><a href="sizes_8h.html#a1f2e85d0eeb03e194221160b0acadd81">kmom</a></div><div class="ttdeci">#define kmom</div><div class="ttdoc">sublattice momentum sites</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00184">sizes.h:184</a></div></div>
<div class="ttc" id="asizes_8h_html_a20074569426d76a5518d4fc993f39687"><div class="ttname"><a href="sizes_8h.html#a20074569426d76a5518d4fc993f39687">nx</a></div><div class="ttdeci">#define nx</div><div class="ttdoc">Lattice x extent.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00066">sizes.h:66</a></div></div>
<div class="ttc" id="asizes_8h_html_a28cbc5ba47a8470a73965695f6a16542"><div class="ttname"><a href="sizes_8h.html#a28cbc5ba47a8470a73965695f6a16542">ngorkov</a></div><div class="ttdeci">#define ngorkov</div><div class="ttdoc">Gor&#39;kov indices.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00181">sizes.h:181</a></div></div>
<div class="ttc" id="asizes_8h_html_a30eff51e2a98ccced567ec489032aabd"><div class="ttname"><a href="sizes_8h.html#a30eff51e2a98ccced567ec489032aabd">ksizet</a></div><div class="ttdeci">#define ksizet</div><div class="ttdoc">Sublattice t extent.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00149">sizes.h:149</a></div></div>
<div class="ttc" id="asizes_8h_html_a36126fb9c56da5fb6713943ca7ea3264"><div class="ttname"><a href="sizes_8h.html#a36126fb9c56da5fb6713943ca7ea3264">kferm2Halo</a></div><div class="ttdeci">#define kferm2Halo</div><div class="ttdoc">Dirac lattice and halo.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00227">sizes.h:227</a></div></div>
<div class="ttc" id="asizes_8h_html_a486c992648d0066d587ac516f62a1acd"><div class="ttname"><a href="sizes_8h.html#a486c992648d0066d587ac516f62a1acd">npx</a></div><div class="ttdeci">#define npx</div><div class="ttdoc">Processor grid x extent. This must be a divisor of nx.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00097">sizes.h:97</a></div></div>
<div class="ttc" id="asizes_8h_html_a55cdab879029c36c07fbd9e7e9b109c9"><div class="ttname"><a href="sizes_8h.html#a55cdab879029c36c07fbd9e7e9b109c9">nadj</a></div><div class="ttdeci">#define nadj</div><div class="ttdoc">adjacent spatial indices</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00175">sizes.h:175</a></div></div>
<div class="ttc" id="asizes_8h_html_a5a091d04c7929c6484096936e72def64"><div class="ttname"><a href="sizes_8h.html#a5a091d04c7929c6484096936e72def64">kvol</a></div><div class="ttdeci">#define kvol</div><div class="ttdoc">Sublattice volume.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00154">sizes.h:154</a></div></div>
<div class="ttc" id="asizes_8h_html_a6ad4b075e3dabd5d5215f7eabbc98e08"><div class="ttname"><a href="sizes_8h.html#a6ad4b075e3dabd5d5215f7eabbc98e08">Complex</a></div><div class="ttdeci">#define Complex</div><div class="ttdoc">Double precision complex number.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00058">sizes.h:58</a></div></div>
<div class="ttc" id="asizes_8h_html_a720c7d27499e99f5661d5e0b6b09348a"><div class="ttname"><a href="sizes_8h.html#a720c7d27499e99f5661d5e0b6b09348a">kferm</a></div><div class="ttdeci">#define kferm</div><div class="ttdoc">sublattice size including Gor&#39;kov indices</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00186">sizes.h:186</a></div></div>
<div class="ttc" id="asizes_8h_html_a770f33f0e08f9a5b2ff02791efef03a7"><div class="ttname"><a href="sizes_8h.html#a770f33f0e08f9a5b2ff02791efef03a7">rescga</a></div><div class="ttdeci">#define rescga</div><div class="ttdoc">Conjugate gradient residue for acceptance.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00242">sizes.h:242</a></div></div>
<div class="ttc" id="asizes_8h_html_a834b9d3c7db59de0d906f00f719ab2f4"><div class="ttname"><a href="sizes_8h.html#a834b9d3c7db59de0d906f00f719ab2f4">npz</a></div><div class="ttdeci">#define npz</div><div class="ttdoc">Processor grid z extent.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00116">sizes.h:116</a></div></div>
<div class="ttc" id="asizes_8h_html_a8705b462037cbb37aaa5cc1660c33062"><div class="ttname"><a href="sizes_8h.html#a8705b462037cbb37aaa5cc1660c33062">nthreads</a></div><div class="ttdeci">#define nthreads</div><div class="ttdoc">Number of threads for OpenMP, which can be overwritten at runtime.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00135">sizes.h:135</a></div></div>
<div class="ttc" id="asizes_8h_html_a8fdb352cd20ab9414865284587408ca5"><div class="ttname"><a href="sizes_8h.html#a8fdb352cd20ab9414865284587408ca5">ksize</a></div><div class="ttdeci">#define ksize</div><div class="ttdoc">Sublattice spatial extent for a cubic lattice.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00146">sizes.h:146</a></div></div>
<div class="ttc" id="asizes_8h_html_a96392c5c7e198251a7efacba03414393"><div class="ttname"><a href="sizes_8h.html#a96392c5c7e198251a7efacba03414393">nf</a></div><div class="ttdeci">#define nf</div><div class="ttdoc">Fermion flavours (double it)</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00151">sizes.h:151</a></div></div>
<div class="ttc" id="asizes_8h_html_aadcdbf20ae08c6005b8972433a4e3aaa"><div class="ttname"><a href="sizes_8h.html#aadcdbf20ae08c6005b8972433a4e3aaa">respbp</a></div><div class="ttdeci">#define respbp</div><div class="ttdoc">Conjugate gradient residue for .</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00238">sizes.h:238</a></div></div>
<div class="ttc" id="asizes_8h_html_aae3965888b92ccefd0fa4d96da415f65"><div class="ttname"><a href="sizes_8h.html#aae3965888b92ccefd0fa4d96da415f65">gvol</a></div><div class="ttdeci">#define gvol</div><div class="ttdoc">Lattice volume.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00092">sizes.h:92</a></div></div>
<div class="ttc" id="asizes_8h_html_ab5757303b45686827c94c395603817af"><div class="ttname"><a href="sizes_8h.html#ab5757303b45686827c94c395603817af">FILELEN</a></div><div class="ttdeci">#define FILELEN</div><div class="ttdoc">Default file name length.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00062">sizes.h:62</a></div></div>
<div class="ttc" id="asizes_8h_html_abe2345c185904513f2178697f721041f"><div class="ttname"><a href="sizes_8h.html#abe2345c185904513f2178697f721041f">halo</a></div><div class="ttdeci">#define halo</div><div class="ttdoc">Total Halo size.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00222">sizes.h:222</a></div></div>
<div class="ttc" id="asizes_8h_html_ac0e106846c6b4f2766406f963e3e9af6"><div class="ttname"><a href="sizes_8h.html#ac0e106846c6b4f2766406f963e3e9af6">Complex_f</a></div><div class="ttdeci">#define Complex_f</div><div class="ttdoc">Single precision complex number.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00056">sizes.h:56</a></div></div>
<div class="ttc" id="asizes_8h_html_ac97223a0b104faae1e25454b2ba2f7a1"><div class="ttname"><a href="sizes_8h.html#ac97223a0b104faae1e25454b2ba2f7a1">npy</a></div><div class="ttdeci">#define npy</div><div class="ttdoc">Processor grid y extent.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00108">sizes.h:108</a></div></div>
<div class="ttc" id="asizes_8h_html_ad08795e9e671720e6f0ec6b3407bf933"><div class="ttname"><a href="sizes_8h.html#ad08795e9e671720e6f0ec6b3407bf933">ndim</a></div><div class="ttdeci">#define ndim</div><div class="ttdoc">Dimensions.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00179">sizes.h:179</a></div></div>
<div class="ttc" id="asizes_8h_html_ad0a75cc73930f4f3c147efd824764b07"><div class="ttname"><a href="sizes_8h.html#ad0a75cc73930f4f3c147efd824764b07">kferm2</a></div><div class="ttdeci">#define kferm2</div><div class="ttdoc">sublattice size including Dirac indices</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00188">sizes.h:188</a></div></div>
<div class="ttc" id="asizes_8h_html_ad19c525e8039fa0d7ce7703442872c88"><div class="ttname"><a href="sizes_8h.html#ad19c525e8039fa0d7ce7703442872c88">npt</a></div><div class="ttdeci">#define npt</div><div class="ttdoc">Processor grid t extent.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00124">sizes.h:124</a></div></div>
<div class="ttc" id="asizes_8h_html_ae64a9369483ee854867cfa822c94bfd1"><div class="ttname"><a href="sizes_8h.html#ae64a9369483ee854867cfa822c94bfd1">kfermHalo</a></div><div class="ttdeci">#define kfermHalo</div><div class="ttdoc">Gor&#39;kov lattice and halo.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00225">sizes.h:225</a></div></div>
<div class="ttc" id="asizes_8h_html_aec60cd5d26e4c776029f09306fee4ac4"><div class="ttname"><a href="sizes_8h.html#aec60cd5d26e4c776029f09306fee4ac4">nz</a></div><div class="ttdeci">#define nz</div><div class="ttdoc">Lattice z extent. We normally use cubic lattices so this is the same as nx.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00080">sizes.h:80</a></div></div>
<div class="ttc" id="asizes_8h_html_af50d69158019ca2b0261d76bc7a0e068"><div class="ttname"><a href="sizes_8h.html#af50d69158019ca2b0261d76bc7a0e068">ny</a></div><div class="ttdeci">#define ny</div><div class="ttdoc">Lattice y extent. We normally use cubic lattices so this is the same as nx.</div><div class="ttdef"><b>Definition</b> <a href="sizes_8h_source.html#l00074">sizes.h:74</a></div></div>
<div class="ttc" id="asu2hmc_8h_html_a247c28a831d22009693ea8465b3f99cd"><div class="ttname"><a href="su2hmc_8h.html#a247c28a831d22009693ea8465b3f99cd">Polyakov</a></div><div class="ttdeci">double Polyakov(Complex_f *ut[2])</div><div class="ttdoc">Calculate the Polyakov loop (no prizes for guessing that one...)</div><div class="ttdef"><b>Definition</b> <a href="bosonic_8c_source.html#l00127">bosonic.c:127</a></div></div>
<div class="ttc" id="asu2hmc_8h_html_a2c38affebb6d51c6132aedeb69e2c46e"><div class="ttname"><a href="su2hmc_8h.html#a2c38affebb6d51c6132aedeb69e2c46e">Average_Plaquette</a></div><div class="ttdeci">int Average_Plaquette(double *hg, double *avplaqs, double *avplaqt, Complex_f *ut[2], unsigned int *iu, float beta)</div><div class="ttdoc">Calculates the gauge action using new (how new?) lookup table.</div><div class="ttdef"><b>Definition</b> <a href="bosonic_8c_source.html#l00020">bosonic.c:20</a></div></div>
<div class="ttc" id="asu2hmc_8h_html_a4f76ed3be4902e11205760b4222665c8"><div class="ttname"><a href="su2hmc_8h.html#a4f76ed3be4902e11205760b4222665c8">Measure</a></div><div class="ttdeci">int Measure(double *pbp, double *endenf, double *denf, Complex *qq, Complex *qbqb, double res, int *itercg, Complex *ut[2], Complex_f *ut_f[2], unsigned int *iu, unsigned int *id, Complex *gamval, Complex_f *gamval_f, int *gamin, double *dk[2], float *dk_f[2], Complex_f jqq, float akappa, Complex *Phi, Complex *R1)</div><div class="ttdoc">Calculate fermion expectation values via a noisy estimator.</div><div class="ttdef"><b>Definition</b> <a href="fermionic_8c_source.html#l00008">fermionic.c:8</a></div></div>
<div class="ttc" id="asu2hmc_8h_html_a84f252348f913fcc70ce5de0aab6f8bf"><div class="ttname"><a href="su2hmc_8h.html#a84f252348f913fcc70ce5de0aab6f8bf">Init</a></div><div class="ttdeci">int Init(int istart, int ibound, int iread, float beta, float fmu, float akappa, Complex_f ajq, Complex *u[2], Complex *ut[2], Complex_f *ut_f[2], Complex *gamval, Complex_f *gamval_f, int *gamin, double *dk[2], float *dk_f[2], unsigned int *iu, unsigned int *id)</div><div class="ttdoc">Initialises the system.</div><div class="ttdef"><b>Definition</b> <a href="su2hmc_8c_source.html#l00019">su2hmc.c:19</a></div></div>
<div class="ttc" id="asu2hmc_8h_html_aad654cdd6107120818d5485ce1620d81"><div class="ttname"><a href="su2hmc_8h.html#aad654cdd6107120818d5485ce1620d81">Hamilton</a></div><div class="ttdeci">int Hamilton(double *h, double *s, double res2, double *pp, Complex *X0, Complex *X1, Complex *Phi, Complex_f *ut[2], unsigned int *iu, unsigned int *id, Complex_f *gamval_f, int *gamin, float *dk[2], Complex_f jqq, float akappa, float beta, double *ancgh, int traj)</div><div class="ttdoc">Calculate the Hamiltonian.</div><div class="ttdef"><b>Definition</b> <a href="su2hmc_8c_source.html#l00245">su2hmc.c:245</a></div></div>
<div class="ttc" id="asu2hmc_8h_html_ab3c213bd9acb695d1ed852737e5b750c"><div class="ttname"><a href="su2hmc_8h.html#ab3c213bd9acb695d1ed852737e5b750c">Reunitarise</a></div><div class="ttdeci">int Reunitarise(Complex *ut[2])</div><div class="ttdoc">Reunitarises u11t and u12t as in conj(u11t[i])*u11t[i]+conj(u12t[i])*u12t[i]=1.</div><div class="ttdef"><b>Definition</b> <a href="matrices_8c_source.html#l01012">matrices.c:1012</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="bosonic_8c_source.html#l00020">Average_Plaquette()</a>, <a class="el" href="sizes_8h_source.html#l00268">AVX</a>, <a class="el" href="sizes_8h_source.html#l00058">Complex</a>, <a class="el" href="sizes_8h_source.html#l00056">Complex_f</a>, <a class="el" href="matrices_8c_source.html#l00585">Dslashd_f()</a>, <a class="el" href="sizes_8h_source.html#l00062">FILELEN</a>, <a class="el" href="random_8c_source.html#l00260">Gauss_c()</a>, <a class="el" href="random_8c_source.html#l00306">Gauss_d()</a>, <a class="el" href="sizes_8h_source.html#l00092">gvol</a>, <a class="el" href="coord_8c_source.html#l00015">h1d</a>, <a class="el" href="coord_8c_source.html#l00015">h1u</a>, <a class="el" href="sizes_8h_source.html#l00222">halo</a>, <a class="el" href="coord_8c_source.html#l00015">halosize</a>, <a class="el" href="su2hmc_8c_source.html#l00245">Hamilton()</a>, <a class="el" href="coord_8c_source.html#l00015">hd</a>, <a class="el" href="coord_8c_source.html#l00015">hu</a>, <a class="el" href="su2hmc_8c_source.html#l00019">Init()</a>, <a class="el" href="sizes_8h_source.html#l00186">kferm</a>, <a class="el" href="sizes_8h_source.html#l00188">kferm2</a>, <a class="el" href="sizes_8h_source.html#l00227">kferm2Halo</a>, <a class="el" href="sizes_8h_source.html#l00225">kfermHalo</a>, <a class="el" href="sizes_8h_source.html#l00184">kmom</a>, <a class="el" href="sizes_8h_source.html#l00146">ksize</a>, <a class="el" href="sizes_8h_source.html#l00149">ksizet</a>, <a class="el" href="sizes_8h_source.html#l00154">kvol</a>, <a class="el" href="integrate_8c_source.html#l00065">Leapfrog()</a>, <a class="el" href="random_8c_source.html#l00041">M_PI</a>, <a class="el" href="fermionic_8c_source.html#l00008">Measure()</a>, <a class="el" href="par__mpi_8h_source.html#l00030">MPI_Finalise</a>, <a class="el" href="sizes_8h_source.html#l00175">nadj</a>, <a class="el" href="sizes_8h_source.html#l00173">nc</a>, <a class="el" href="sizes_8h_source.html#l00179">ndim</a>, <a class="el" href="sizes_8h_source.html#l00151">nf</a>, <a class="el" href="sizes_8h_source.html#l00181">ngorkov</a>, <a class="el" href="sizes_8h_source.html#l00124">npt</a>, <a class="el" href="sizes_8h_source.html#l00097">npx</a>, <a class="el" href="sizes_8h_source.html#l00108">npy</a>, <a class="el" href="sizes_8h_source.html#l00116">npz</a>, <a class="el" href="sizes_8h_source.html#l00086">nt</a>, <a class="el" href="sizes_8h_source.html#l00135">nthreads</a>, <a class="el" href="sizes_8h_source.html#l00066">nx</a>, <a class="el" href="sizes_8h_source.html#l00074">ny</a>, <a class="el" href="sizes_8h_source.html#l00080">nz</a>, <a class="el" href="integrate_8c_source.html#l00116">OMF2()</a>, <a class="el" href="integrate_8c_source.html#l00194">OMF4()</a>, <a class="el" href="par__mpi_8c_source.html#l00025">Par_begin()</a>, <a class="el" href="par__mpi_8h.html#aecfe9840e5f8dfd693b813b750d81a0c">Par_dsum()</a>, <a class="el" href="par__mpi_8h.html#a31e5f4f36c6e583903e8dd06dbf76fc6">Par_fcopy()</a>, <a class="el" href="random_8c_source.html#l00190">Par_granf()</a>, <a class="el" href="par__mpi_8h.html#a82049c8a7fcf726d3b222e4fedf6f674">Par_icopy()</a>, <a class="el" href="par__mpi_8c_source.html#l00341">Par_swrite()</a>, <a class="el" href="par__mpi_8c_source.html#l00019">pcoord</a>, <a class="el" href="bosonic_8c_source.html#l00127">Polyakov()</a>, <a class="el" href="par__mpi_8c_source.html#l00022">rank</a>, <a class="el" href="sizes_8h_source.html#l00242">rescga</a>, <a class="el" href="sizes_8h_source.html#l00240">rescgg</a>, <a class="el" href="sizes_8h_source.html#l00238">respbp</a>, <a class="el" href="matrices_8c_source.html#l01012">Reunitarise()</a>, <a class="el" href="random_8c_source.html#l00027">seed</a>, <a class="el" href="par__mpi_8c_source.html#l00022">size</a>, and <a class="el" href="par__mpi_8c_source.html#l01178">Trial_Exchange()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph.svg" width="882" height="1299"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="main_8c.html">main.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
